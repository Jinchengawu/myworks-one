{"remainingRequest":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhanyuan/code/oc-works/fuli/src/views/addLoan/addLoan.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhanyuan/code/oc-works/fuli/src/views/addLoan/addLoan.vue","mtime":1564472355648},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { lendItem, lendConfirm,addLend } from '@/service/customer'\nimport { mapState } from 'vuex'\nimport { formatDate, isNull } from '@/utils'\n// import { TMap } from \"../../utils/Map.js\";\n\nexport default {\n  name: 'AddLoan',\n  data() {\n    return {\n      projectName: '',\n      project: '',\n      lendItemD: {\n        lendingItem:{}\n      },\n      OTP:1,\n      selectStartTime: false,      \n      maxDate: new Date(),\n      minDate: '',\n      currentTime: new Date(),\n    }\n  },\n  computed: {\n    ...mapState(['companyName']),\n  },\n  watch: {},\n  mounted() { },\n  created() {\n    const nowDate = new Date(new Date().toLocaleDateString()) // 获取当前时间\n    this.minDate = new Date(nowDate.getTime() - 2 * 24 * 60 * 60 * 1000)\n    this.getLendItem()\n    this.OTP = this.$route.query.OTP\n  },\n  methods: {\n    //新增投放项目（投放子项目）\n    addLendItem(){\n      let params = this.lendItemD.lendingItem\n      let txts = {                                \n        lendAmount:'投放金额',\n        lendTime:'投放时间',        \n      } \n      if (!this.$checkFrom(params,txts)) {\n        return\n      }\n      params.lendId = this.$route.query.id\n      addLend(params).then(res=>{\n        // console.log('新增投放项目（投放子项目）',res)\n         this.$router.go(-1)\n      })\n    },\n    //\n     startTimeClick() {\n      this.selectStartTime = true\n    },\n    startconfirm(e) {\n      // 选开始时间\n      if (isNull(e)) {\n        this.selectStartTime = false\n      } else {\n        const time = formatDate(new Date(e), 'yyyy-MM-dd', 'special')\n        const timeStr = time.split('-')\n        this.lendItemD.lendingItem.lendTime = ` ${timeStr[0]}-${timeStr[1]}-${timeStr[2]}`\n        this.selectStartTime = false\n      }\n    },  \n    formatter(type, value) {\n      if (type === 'year') {\n        return `${value}年`\n      } if (type === 'month') {\n        return `${value}月`\n      }\n      return `${value}日`\n    },\n    \n    getLendItem() {\n      lendItem({ id: this.$route.query.id }).then((res) => {\n        // console.log('投放项目查询(投放列表)', res)\n\n        this.lendItemD = res.data\n        this.lendItemD.lendingItemList.map(d=>{\n          d.lendTime = formatDate(new Date(d.lendTime) ,'yyyy-MM-dd')\n        })\n        // this.lendItemD.lendingItemList.reverse()\n      })\n    },\n    //风控财务确认\n    setLendConfirm(type) {\n      const parmas = {\n        id: this.lendItemD.lendingItem.id,\n        riskManagementId: this.$store.getters.userInfo.id, // 风控确认时需要\n        financeId: this.$store.getters.userInfo.id, // 财务确认时需要\n      }\n      if (type === 2) {\n        delete parmas.riskManagementId\n      } else {\n        delete parmas.financeId\n      }\n      lendConfirm(parmas).then((res) => {\n        // console.log('投放项目确认（风控和财务）', res)\n        this.$router.go(-1)\n      })\n    },\n  },\n}\n",{"version":3,"sources":["addLoan.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsLA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addLoan.vue","sourceRoot":"src/views/addLoan","sourcesContent":["<template>\n  <div class=\"addLoan\">\n    <div class=\"container\">\n      <van-cell-group :border=\"false\">\n        <van-field\n          v-model=\"lendItemD.lendingItem.companyName\"\n          label=\"客户\"\n          type=\"text\"\n          input-align=\"right\"\n          placeholder=\"请输入\"\n          :error=\"false\"\n          :border=\"false\"\n          :readonly=\"OTP!=1\"\n        />\n        <van-field\n          v-model=\"lendItemD.lendingItem.projectName\"\n          label=\"所属项目\"\n          type=\"text\"\n          input-align=\"right\"\n          placeholder=\"请填写承租人信息\"\n          :error=\"false\"\n          :border=\"false\"\n          :readonly=\"OTP!=1\"\n        />\n        <div\n          v-if=\"OTP==1\"\n          class=\"select-list\"\n        >\n          <div\n            class=\"list\"\n            @click=\"startTimeClick()\"\n          >          \n            <div class=\"left\">\n              投放时间\n            </div>\n            <div\n              class=\"right\"\n              :class=\"{'selectPlaceholder':lendItemD.lendingItem.lendTime== ''}\"\n            >\n              {{ lendItemD.lendingItem.lendTime== '' ? '请选择' : lendItemD.lendingItem.lendTime }}\n            </div>\n            <div class=\"timeBox\">\n              <span\n                class=\"iconfont iconrili\"\n                style=\"color:#aebab4\"\n              />\n            </div>\n          </div>\n        </div>\n        <div class=\"money-text\">\n          <van-field\n            v-model=\"lendItemD.lendingItem.contractAmount\"\n            style=\"width:90%;\"\n            label=\"合约金额\"\n            type=\"number\"\n            input-align=\"right\"\n            placeholder=\"请输入合约金额 单位:\"\n            :error=\"false\"\n            :border=\"false\"\n            :readonly=\"OTP!=1\"\n          />\n          <span class=\"right-text\">万元</span>\n        </div>\n        <div\n          v-if=\"OTP==1\"\n          class=\"money-text\"\n        >\n          <van-field\n            v-model=\"lendItemD.lendingItem.lendAmount\"\n         \n            style=\"width:90%;\"\n            label=\"投放金额\"\n            type=\"number\"\n            input-align=\"right\"\n            placeholder=\"请输入投放金额  单位:\"\n            :error=\"false\"\n            :border=\"false\"\n          />\n          <span class=\"right-text\">万元</span>\n        </div>\n        <div class=\"select-map\">\n          <div class=\"title-header\">\n            投放记录\n          </div>\n          <div class=\"body\">\n            <div\n              v-for=\"(itm,idx) in lendItemD.lendingItemList\"\n              :key=\"idx\"\n              class=\"item-list\"\n            >\n              <van-row>\n                <van-col span=\"8\">\n                  {{ itm.lendTime }}\n                </van-col>\n                <van-col\n                  style=\"text-align: center;\"\n                  span=\"8\"\n                >\n                  投放: {{ itm.lendAmount }}万元\n                </van-col>\n                <van-col\n                  style=\"text-align: right;\"\n                  span=\"8\"\n                >\n                  第{{ lendItemD.lendingItemList.length-idx }}次投放\n                </van-col>\n              </van-row>\n            </div>\n          </div>\n        </div>\n      </van-cell-group>\n      <!-- <div class=\"clear-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"addLendItem\"\n               v-if='OTP==1'\n              >新建</div> -->\n      <div class=\"footer\">\n        <van-row>\n          <van-col\n            v-if=\"OTP==1\"\n            span=\"24\"\n          >\n            <van-button\n              class=\"confirm-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"addLendItem\"\n            >\n              新建\n            </van-button>\n          </van-col>\n          <van-col\n            v-if=\"lendItemD.lendingItem.status==1\"\n            span=\"24\"\n          >\n            <van-button\n              class=\"confirm-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"setLendConfirm(1)\"\n            >\n              风控确认\n            </van-button>\n          </van-col>\n          <van-col\n            v-if=\"lendItemD.lendingItem.status==2\"\n            span=\"24\"\n          >\n            <van-button\n              class=\"confirm-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"setLendConfirm(2)\"\n            >\n              财务确认\n            </van-button>\n          </van-col>\n        </van-row>\n      </div>\n    </div>\n    <!-- 时间选择 -->\n    <van-popup\n      v-model=\"selectStartTime\"\n      position=\"bottom\"\n      :overlay=\"true\"\n    >\n      <van-datetime-picker\n        v-model=\"currentTime\"\n        type=\"date\"\n        :formatter=\"formatter\"\n        @confirm=\"startconfirm($event)\"\n        @cancel=\"startconfirm()\"\n      />\n    </van-popup>\n  </div>\n</template>\n<script>\nimport { lendItem, lendConfirm,addLend } from '@/service/customer'\nimport { mapState } from 'vuex'\nimport { formatDate, isNull } from '@/utils'\n// import { TMap } from \"../../utils/Map.js\";\n\nexport default {\n  name: 'AddLoan',\n  data() {\n    return {\n      projectName: '',\n      project: '',\n      lendItemD: {\n        lendingItem:{}\n      },\n      OTP:1,\n      selectStartTime: false,      \n      maxDate: new Date(),\n      minDate: '',\n      currentTime: new Date(),\n    }\n  },\n  computed: {\n    ...mapState(['companyName']),\n  },\n  watch: {},\n  mounted() { },\n  created() {\n    const nowDate = new Date(new Date().toLocaleDateString()) // 获取当前时间\n    this.minDate = new Date(nowDate.getTime() - 2 * 24 * 60 * 60 * 1000)\n    this.getLendItem()\n    this.OTP = this.$route.query.OTP\n  },\n  methods: {\n    //新增投放项目（投放子项目）\n    addLendItem(){\n      let params = this.lendItemD.lendingItem\n      let txts = {                                \n        lendAmount:'投放金额',\n        lendTime:'投放时间',        \n      } \n      if (!this.$checkFrom(params,txts)) {\n        return\n      }\n      params.lendId = this.$route.query.id\n      addLend(params).then(res=>{\n        // console.log('新增投放项目（投放子项目）',res)\n         this.$router.go(-1)\n      })\n    },\n    //\n     startTimeClick() {\n      this.selectStartTime = true\n    },\n    startconfirm(e) {\n      // 选开始时间\n      if (isNull(e)) {\n        this.selectStartTime = false\n      } else {\n        const time = formatDate(new Date(e), 'yyyy-MM-dd', 'special')\n        const timeStr = time.split('-')\n        this.lendItemD.lendingItem.lendTime = ` ${timeStr[0]}-${timeStr[1]}-${timeStr[2]}`\n        this.selectStartTime = false\n      }\n    },  \n    formatter(type, value) {\n      if (type === 'year') {\n        return `${value}年`\n      } if (type === 'month') {\n        return `${value}月`\n      }\n      return `${value}日`\n    },\n    \n    getLendItem() {\n      lendItem({ id: this.$route.query.id }).then((res) => {\n        // console.log('投放项目查询(投放列表)', res)\n\n        this.lendItemD = res.data\n        this.lendItemD.lendingItemList.map(d=>{\n          d.lendTime = formatDate(new Date(d.lendTime) ,'yyyy-MM-dd')\n        })\n        // this.lendItemD.lendingItemList.reverse()\n      })\n    },\n    //风控财务确认\n    setLendConfirm(type) {\n      const parmas = {\n        id: this.lendItemD.lendingItem.id,\n        riskManagementId: this.$store.getters.userInfo.id, // 风控确认时需要\n        financeId: this.$store.getters.userInfo.id, // 财务确认时需要\n      }\n      if (type === 2) {\n        delete parmas.riskManagementId\n      } else {\n        delete parmas.financeId\n      }\n      lendConfirm(parmas).then((res) => {\n        // console.log('投放项目确认（风控和财务）', res)\n        this.$router.go(-1)\n      })\n    },\n  },\n}\n</script>\n<style lang=\"less\" scoped>\n.container {\n  width: 100%;\n  padding-bottom: 100px;\n  .select-list {\n    width: 100%;\n    padding: 0px 0px 0px 15px;\n    box-sizing: border-box;\n    .addborder {\n      border-bottom: 1px solid #f5f6f8;\n    }\n    .list {\n      width: 100%;\n      height: 40px;\n      display: flex;\n      line-height: 40px;\n      background-color: #fff;\n      color: #323233;\n      font-size: 14px;\n      overflow: hidden;\n      color: #323233;\n      font-size: 14px;\n      box-sizing: border-box;\n      padding-right: 15px;\n      .left {\n        max-width: 90px;\n        height: 40px;\n      }\n      .right {\n        flex: 1;\n        height: 40px;\n        text-align: right;\n        select {\n          width: 100%;\n          height: 40px;\n          text-align: right;\n          border: none;\n          outline: none;\n          appearance: none;\n          -moz-appearance: none;\n          -webkit-appearance: none;\n          -ms-appearance: none;\n          direction: rtl;\n          text-indent: 5px;\n          background: #ffffff;\n        }\n      }\n    }\n    .saojiao {\n      width: 0;\n      height: 0;\n      border-width: 6px;\n      border-style: solid;\n      border-color: #323233 transparent transparent transparent;\n      margin-top: 17px;\n    }\n    .timeBox {\n      width: 25px;\n      height: 40px;\n      text-align: right;\n    }\n  }\n  .select-map {\n    width: 100%;\n    box-sizing: border-box;\n    .title-header {\n      width: 100%;\n      height: 40px;\n      display: flex;\n      line-height: 40px;\n      background-color: #fff;\n      color: #323233;\n      font-size: 14px;\n      overflow: hidden;\n      color: #323233;\n      font-size: 14px;\n      padding-left: 15px;\n    }\n    .body {\n      width: 100%;\n      .item-list {\n        width: 100%;\n        height: 40px;\n        line-height: 40px;\n        font-size: 12px;\n        color: #333333;\n        padding: 0 15px;\n        box-sizing: border-box;\n      }\n      .item-list:nth-child(2n-1) {\n        background: #f3f3f3;\n      }\n    }\n    .uploadFile {\n      width: 100px;\n      height: 100px;\n      border: 1px dashed #979797;\n      position: relative;\n      .uploadIcon {\n        font-size: 30px;\n        position: absolute;\n        top: 15px;\n        left: 35px;\n        color: #979797;\n      }\n      .uploadText {\n        width: 65px;\n        font-size: 16px;\n        position: absolute;\n        top: 50px;\n        left: 20px;\n        color: #979797;\n      }\n    }\n  }\n  .footer {\n    width: 100%;\n    height: 44px;\n    background: #fcfcfc;\n    position: fixed;\n    bottom: 0;\n    left: 0;\n  }\n}\n</style>\n"]}]}