{"remainingRequest":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhanyuan/code/oc-works/fuli/src/views/customerManagement/tab-investigation.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhanyuan/code/oc-works/fuli/src/views/customerManagement/tab-investigation.vue","mtime":1564134165926},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import { api, get } from \"@api\";\n// import { mapState, mapMutations } from 'vuex'\nimport { isNull,addMark } from '@/utils'\nimport { projectList,messageList,addMessages } from '@/service/customer'\n\nexport default {\n  name: 'Investigation',\n  data() {\n    return {\n      PermissionObj:this.$store.state.powerList.PermissionObj,///权限\n      messageBoard: false,\n      AddmessageBoard: false,\n      messageStr: '',\n      messageError: false,\n      investList:[],\n      totalLog: null,\n      loadingLog: false,\n      finishedLog: false,\n      finished_text: '没有更多数据啦',\n      error: false,\n      pageLog: 1,\n      size: 5,\n      messageLists:[]\n    }\n  },\n  computed: {},\n  created() {\n  },\n  methods: {\n    // 加载数据\n    onLoad() {\n      const that = this\n      if (this.investList.length === this.totalLog) {\n        this.finishedLog = true // 数据全部加载完成\n        this.loadingLog = false// 加载状态结束\n        return\n      }\n      // 下拉加载事件\n      setTimeout(() => {\n        that.getProjectList()\n      }, 1000)      \n    },\n    getProjectList() {\n      const params = {\n        menuType: 3,\n        page: this.pageLog,\n        size: this.size,\n      }\n      projectList(params).then((res) => {\n        console.log('projectList', res)\n        this.investList = this.investList.concat(res.data)\n        this.investList = addMark(this.investList,3)    \n        this.totalLog = res.total\n        this.pageLog += 1\n        this.loadingLog = false// 加载状态结束\n        // this.quoteList = addMark(this.quoteList,3)  \n      })\n    },    \n    //唤醒留言表单\n    addMessage(item) {\n      console.log('item',item)\n      this.setingItem = item\n      this.messageBoard = false\n      setTimeout(() => {\n        // 加载状态结束\n        this.AddmessageBoard = true\n      }, 300)\n    },\n    //展示留言\n    showMessage(item){\n      this.messageBoard = !this.messageBoard\n      this.setingMessage = item\n      item.isRead = true\n      this.getMessageList(item)\n    },\n    //获取留言列表\n    getMessageList(item){\n      console.log('获取留言列表',item)\n      let params = {\n        eventType:7,\n        eventId:item.id,\n        messageId:item.messageId,\n      }\n      messageList(params).then(res=>{\n        this.messageLists = res.data || []\n        console.log('获取留言',res)\n      })\n    },\n    //新增留言\n    setMessage(){      \n      let params = {\n        author:this.$store.getters.userInfo.name,\n        authorUserId:this.$store.getters.userInfo.id,\n        eventId:this.setingItem.eventId,\n        content:this.messageStr,\n        eventType:7\n      }\n      console.log('新增留言',params)\n      addMessages(params).then(res=>{\n        console.log('获取留言',res)\n        this.messageStr = ''\n        this.messageError = false     \n        this.AddmessageBoard = false\n        this.getInit()\n        this.onLoad()\n      })\n    },\n    getInit(){\n      this.page=1\n      this.pageLog = 1\n      this.investList = []\n      this.totalLog = null\n      this.total = null\n    },\n    // 留言板取消事件\n    messageClear() {      \n      this.AddmessageBoard = false\n      this.messageStr = ''\n    },\n    // 留言保存事件\n    messageSave() {\n      console.log('留言保存事件',this.messageStr)\n      this.setMessage()\n      if (isNull(this.messageStr)) {\n        this.messageError = true\n        return\n      }      \n    },\n    //事件详情\n    itemDetails(id){\n      this.$router.push({\n        path:'/addInvestigation',\n        query:{\n          id,\n        }\n      })\n    }\n    \n\n  },\n}\n",{"version":3,"sources":["tab-investigation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2JA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA","file":"tab-investigation.vue","sourceRoot":"src/views/customerManagement","sourcesContent":["<template>\n  <div name=\"investigation\">\n    <div class=\"contact_container7\">\n      <div class=\"contact_container_er\">\n        <van-list\n          v-model=\"loadingLog\"\n          :finished=\"finishedLog\"\n          :finished-text=\"finished_text\"\n          :error.sync=\"error\"\n          error-text=\"请求失败，点击重新加载\"\n          @load=\"onLoad()\"\n        >\n          <div\n            v-for=\"(item,idx) in investList\"\n            :key=\"idx\"\n            class=\"item-list\"\n            @click=\"itemDetails(item.id)\"\n          >\n            <div class=\"item-left\">\n              <div\n                :class=\"{'xian':true,'xianTop':item.top,'xianBottom':item.bottom}\"\n              />\n              <div :class=\"{'circular':true,'theme-background-colors':item.top||item.bottom}\" />\n            </div>\n            <div class=\"item-right\">\n              <div class=\"right\">\n                <div class=\"top\">\n                  <h4 class=\"text_h4\">\n                    {{ item.companyName }}\n                  </h4>\n                  <p class=\"text_p\">\n                    动作:尽调\n                  </p>\n                  <p class=\"text_p\">\n                    最后跟进时间:{{ item.createTime }}\n                  </p>\n                  <p class=\"text_p\">\n                    所属项目:{{ item.information.projectName }}\n                  </p>\n                  <span\n                    v-if=\"!item.operationInfo && PermissionObj['messageboard_insert'] != undefined\"\n                    style=\"position:absolute;right:10px;bottom:65px;\"\n                    class=\"iconfont iconliuyan theme-colors\"\n                    @click.stop=\"addMessage(item)\"\n                  />\n                  <div\n                    v-if=\"item.content !== null\"\n                    class=\"message\"\n                    @click.stop=\"showMessage(item)\"\n                  >\n                    <div class=\"message-left\">\n                      {{ item.content }}\n                    </div>\n                    <div\n                      class=\"message-right\"\n                    >\n                      <span>{{ item.boaCreateTime }}</span>\n                      <van-icon\n                        style=\"position:relative;top:2px;\"\n                        name=\"arrow\"\n                      />\n                    </div>\n\n                    <span\n                      v-if=\"!item.isRead\"\n                      style=\"position:absolute;right:0;top:1px;color:#ff0021;\"\n                      class=\"iconfont iconnew\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </van-list>\n      </div>\n      \n      <div\n        v-if=\"PermissionObj['duediligence_insert'] != undefined\"\n        class=\"tab-footer\"\n      >\n        <van-button\n          class=\"gradual-btn\"\n          style=\"width:100%;\"\n          type=\"primary\"\n          to=\"/addInvestigation\"\n        >\n          新建尽调事件\n        </van-button>\n      </div>\n    </div>\n\n    <!-- 留言板弹层 -->\n    <van-popup v-model=\"messageBoard\">\n      <div class=\"messageBoard\">\n        <div class=\"header\">\n          留言板\n        </div>\n        <div\n          v-for=\"(item,idx) in messageLists\"\n          :key=\"idx\"\n          class=\"container\"\n        >\n          <div class=\"container_header\">\n            <span style=\"float:left;\">{{ item.author }}</span>\n            <span style=\"float:right;\">{{ item.createTime }}</span>\n          </div>\n          <div class=\"container_p\">\n            {{ item.content }}\n          </div>\n        </div>\n      </div>\n    </van-popup>\n\n    <!--新增留言弹层 -->\n    <van-popup v-model=\"AddmessageBoard\">\n      <div class=\"messageBoard\">\n        <div class=\"header\">\n          留言板\n        </div>\n        <div class=\"container\">\n          <textarea\n            v-model=\"messageStr\"\n            :class=\"messageError ? 'textarea_no' :'textarea_yes'\"\n            placeholder=\"请输入留言\"\n          />\n        </div>\n        <van-row>\n          <van-col span=\"12\">\n            <van-button\n              class=\"clear-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"messageClear()\"\n            >\n              取消\n            </van-button>\n          </van-col>\n          <van-col span=\"12\">\n            <van-button\n              class=\"confirm-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"messageSave()\"\n            >\n              确定\n            </van-button>\n          </van-col>\n        </van-row>\n      </div>\n    </van-popup>\n  </div>\n</template>\n<script>\n// import { api, get } from \"@api\";\n// import { mapState, mapMutations } from 'vuex'\nimport { isNull,addMark } from '@/utils'\nimport { projectList,messageList,addMessages } from '@/service/customer'\n\nexport default {\n  name: 'Investigation',\n  data() {\n    return {\n      PermissionObj:this.$store.state.powerList.PermissionObj,///权限\n      messageBoard: false,\n      AddmessageBoard: false,\n      messageStr: '',\n      messageError: false,\n      investList:[],\n      totalLog: null,\n      loadingLog: false,\n      finishedLog: false,\n      finished_text: '没有更多数据啦',\n      error: false,\n      pageLog: 1,\n      size: 5,\n      messageLists:[]\n    }\n  },\n  computed: {},\n  created() {\n  },\n  methods: {\n    // 加载数据\n    onLoad() {\n      const that = this\n      if (this.investList.length === this.totalLog) {\n        this.finishedLog = true // 数据全部加载完成\n        this.loadingLog = false// 加载状态结束\n        return\n      }\n      // 下拉加载事件\n      setTimeout(() => {\n        that.getProjectList()\n      }, 1000)      \n    },\n    getProjectList() {\n      const params = {\n        menuType: 3,\n        page: this.pageLog,\n        size: this.size,\n      }\n      projectList(params).then((res) => {\n        console.log('projectList', res)\n        this.investList = this.investList.concat(res.data)\n        this.investList = addMark(this.investList,3)    \n        this.totalLog = res.total\n        this.pageLog += 1\n        this.loadingLog = false// 加载状态结束\n        // this.quoteList = addMark(this.quoteList,3)  \n      })\n    },    \n    //唤醒留言表单\n    addMessage(item) {\n      console.log('item',item)\n      this.setingItem = item\n      this.messageBoard = false\n      setTimeout(() => {\n        // 加载状态结束\n        this.AddmessageBoard = true\n      }, 300)\n    },\n    //展示留言\n    showMessage(item){\n      this.messageBoard = !this.messageBoard\n      this.setingMessage = item\n      item.isRead = true\n      this.getMessageList(item)\n    },\n    //获取留言列表\n    getMessageList(item){\n      console.log('获取留言列表',item)\n      let params = {\n        eventType:7,\n        eventId:item.id,\n        messageId:item.messageId,\n      }\n      messageList(params).then(res=>{\n        this.messageLists = res.data || []\n        console.log('获取留言',res)\n      })\n    },\n    //新增留言\n    setMessage(){      \n      let params = {\n        author:this.$store.getters.userInfo.name,\n        authorUserId:this.$store.getters.userInfo.id,\n        eventId:this.setingItem.eventId,\n        content:this.messageStr,\n        eventType:7\n      }\n      console.log('新增留言',params)\n      addMessages(params).then(res=>{\n        console.log('获取留言',res)\n        this.messageStr = ''\n        this.messageError = false     \n        this.AddmessageBoard = false\n        this.getInit()\n        this.onLoad()\n      })\n    },\n    getInit(){\n      this.page=1\n      this.pageLog = 1\n      this.investList = []\n      this.totalLog = null\n      this.total = null\n    },\n    // 留言板取消事件\n    messageClear() {      \n      this.AddmessageBoard = false\n      this.messageStr = ''\n    },\n    // 留言保存事件\n    messageSave() {\n      console.log('留言保存事件',this.messageStr)\n      this.setMessage()\n      if (isNull(this.messageStr)) {\n        this.messageError = true\n        return\n      }      \n    },\n    //事件详情\n    itemDetails(id){\n      this.$router.push({\n        path:'/addInvestigation',\n        query:{\n          id,\n        }\n      })\n    }\n    \n\n  },\n}\n</script>\n<style lang=\"less\" scoped>\n.contact_container7 {\n  width: 100%;\n  padding: 10px 20px 70px 20px;\n  box-sizing: border-box;\n  background: #fcfcfc;\n  .item-list {\n    width: 100%;\n    display: flex;\n    box-sizing: border-box;\n    .item-left {\n      width: 24px;\n      margin-right: 10px;\n      position: relative;\n      .xianTop{\n        height: 50% !important;\n      }\n      .xianBottom{\n        height: 50% !important;\n        top:0 !important;\n      }\n      .xian {\n        width: 2px;\n        height: 100%;\n        position: absolute;\n        bottom: 0;\n        left: 11px;\n        background: #dddddd;\n      }\n      .circular {\n        width: 24px;\n        height: 24px;\n        border-radius: 12px;\n        background: #dddddd;\n        position: absolute;\n        bottom: 50%;\n        left: 0px;\n      }\n    }\n    .item-right {\n      min-width: 0;\n      flex: 1;\n      padding-bottom: 20px;\n      .time {\n        width: 100%;\n        height: 35px;\n        line-height: 35px;\n        color: #626262;\n        font-size: 12px;\n      }\n      .right {\n        width: 100%;\n        background: #ffffff;\n        box-shadow: 0 2px 8px 0 rgba(153, 153, 153, 0.24);\n        border-radius: 8px;\n        .top {\n          width: 100%;\n          box-sizing: border-box;\n          padding: 10px 20px;\n          position: relative;\n          .describe {\n            position: absolute;\n            right: 15px;\n            top: 10px;\n            color: #999999;\n            font-size: 12px;\n          }\n          .text_h4 {\n            margin-bottom: 10px;\n            color: #03c061;\n            font-size: 16px;\n            font-weight: bolder;\n          }\n          .text_p {\n            width: 100%;\n            height: 25px;\n            line-height: 25px;\n            color: #333333;\n            font-size: 12px;\n          }\n        }\n        .message {\n          width: 100%;\n          padding: 5px 0px 0px 10px;\n          box-sizing: border-box;\n          border-top: 1px dashed #dddddd;\n          display: flex;\n          position: relative;\n          .message-left {\n            width: 65%;\n            height: 20px;\n            line-height: 20px;\n            font-size: 12px;\n            color: #333333;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            min-width: 0;\n          }\n          .message-right {\n            width: 35%;\n            height: 20px;\n            min-width: 0;\n            line-height: 20px;\n            text-align: right;\n            font-size: 12px;\n            color: #333333;\n          }\n        }\n      }\n    }\n  }\n}\n.tab-footer {\n  width: 100%;\n  height: 70px;\n  background: #fcfcfc;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  padding: 0 10px;\n  box-sizing: border-box;\n}\n.messageBoard {\n  width: 240px;\n  .header {\n    width: 90%;\n    margin: 0 auto;\n    height: 40px;\n    font-size: 16px;\n    font-weight: bold;\n    line-height: 40px;\n    text-align: center;\n    border-bottom: 1px solid #dddddd;\n    position: relative;\n    .header-btn {\n      position: absolute;\n      right: 0;\n      top: 0;\n      color: #00703a;\n      font-size: 14px;\n      font-weight: normal;\n    }\n  }\n  .container {\n    width: 90%;\n    margin: 0 auto;\n    min-height: 150px;\n    .container_header {\n      width: 100%;\n      height: 35px;\n      line-height: 35px;\n      color: #626262;\n      font-size: 12px;\n    }\n    .container_p {\n      width: 100%;\n      line-height: 20px;\n      color: #333333;\n      font-size: 12px;\n    }\n    textarea {\n      width: 100%;\n      max-height: 120px;\n      min-height: 120px;\n      padding: 10px;\n      font-size: 12px;\n      box-sizing: border-box;\n      outline: none;\n      resize: none;\n      overflow-y: auto;\n    }\n    .textarea_no {\n      border: 1px solid #ff0021;\n    }\n    .textarea_yes {\n      border: 1px solid #999999;\n    }\n  }\n}\n</style>\n"]}]}