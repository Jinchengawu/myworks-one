{"remainingRequest":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhanyuan/code/oc-works/fuli/src/views/customerManagement/tab-visit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhanyuan/code/oc-works/fuli/src/views/customerManagement/tab-visit.vue","mtime":1564134165927},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import { api, get } from \"@api\";\n// import { mapState, mapMutations } from 'vuex'\nimport { VisitList } from '@/service/customer'\nimport { formatDate, isNull } from '@/utils'\n\nexport default {\n  name: 'Visit',\n  data() {\n    return {\n      PermissionObj:this.$store.state.powerList.PermissionObj,///权限\n      selectTime: false,\n      searchDate:new Date(),\n      maxDate: new Date(),\n      selectTimeStr: '',\n      VTList: [],\n      total: null,\n      page: 1,\n      size: 5,\n      tabIndex: 1,\n      loading: false,\n      finished: false,\n      finished_text: '没有更多数据啦',\n      error: false,\n      searchObj: null,\n      visitName:''\n    }\n  },\n  computed: {},\n  created() {\n    // this.getVisitList()\n  },\n  methods: {\n    clearTime(){\n      this.selectTimeStr = null\n      this.initList()\n    },\n    formatter(type, value) {\n      if (type === 'year') {\n        return `${value}年`\n      } if (type === 'month') {\n        return `${value}月`\n      }\n      return `${value}日`\n    },\n    showSelectTime() {\n      this.selectTime = !this.selectTime\n    },\n    startconfirm(e) {\n      if (isNull(e)) {\n        this.selectTime = false\n      } else {\n        const time = formatDate(new Date(e), 'yyyy-MM-dd')\n        console.log('time',time)\n        this.selectTimeStr = time\n        this.selectTime = false\n        this.searchChange()\n      }\n    },\n    // 获取拜访列表\n    getVisitList() {\n      const params = {\n        userId: this.$store.getters.userInfo.id,\n        visitName:this.visitName,\n        visitTime:this.selectTimeStr,\n        page:this.page,\n        size:this.size\n      }\n      VisitList(params).then((res) => {\n        console.log('getVisitList', res)\n        this.VTList = this.VTList.concat(res.data.data)\n        this.total = res.data.total\n        this.page += 1\n        this.loading = false// 加载状态结束\n      })\n    },\n    // 加载数据\n    onLoad(searchObj) {\n      const that = this\n      if (this.VTList.length === this.total) {\n        this.finished = true // 数据全部加载完成\n        this.loading = false// 加载状态结束\n        return\n      }\n      searchObj = searchObj || this.searchObj\n      // 下拉加载事件\n      if (that.tabIndex === 1) {\n        setTimeout(() => {\n          that.getVisitList(searchObj)\n        }, 1000)\n      }\n    },\n    //初始化列表配置\n    initList(){\n      this.total = null\n      this.page = 1\n      this.loading = true// 加载状态结束\n      this.VTList = []\n      this.onLoad()\n    },\n    //formChange\n    searchChange(){\n      this.initList()\n    },\n    //\n    routerTo(itm,OTP) {\n      if(itm.createUserId!=this.$store.getters.userInfo.id&&OTP==1){\n        this.$toast('非拜访创建人无权编辑该拜访！')\n        return\n      }\n      this.$router.push({\n        path: '/addVisit',\n        query: {\n          id:itm.visitId,\n          OTP\n        },\n      })\n    },\n  },\n}\n",{"version":3,"sources":["tab-visit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8GA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"tab-visit.vue","sourceRoot":"src/views/customerManagement","sourcesContent":["<template>\n  <div name=\"visit\">\n    <div class=\"contact_container5\">\n      <div class=\"tab5_box\">\n        <div class=\"tab5-search\">\n          <form\n            action=\"\"\n            @submit.prevent=\"searchChange\"\n          >\n            <input\n              v-model=\"visitName\"\n              type=\"text\"\n              placeholder=\"请输入拜访人姓名\"\n            >\n          </form>\n          \n\n          <div\n            class=\"selectTime\"\n            @click=\"showSelectTime()\"\n          >\n            {{ selectTimeStr== '' ? '请选择时间' : selectTimeStr }}\n            <van-icon\n              v-if=\"selectTimeStr\"\n              name=\"cross\"\n              class=\"clearTime\"\n              @click.stop=\"clearTime\"\n            />\n            <!-- <span >清除</span> -->\n          </div>\n        </div>\n        <van-list\n          v-model=\"loading\"\n          :finished=\"finished\"\n          :finished-text=\"finished_text\"\n          :error.sync=\"error\"\n          error-text=\"请求失败，点击重新加载\"\n          @load=\"onLoad()\"\n        >\n          <div\n            v-for=\"(itm,idx) in VTList\"\n            :key=\"idx\"\n            class=\"tab5-list\"\n            @click.stop=\"routerTo(itm,2)\"\n          >\n            <div class=\"tab5-list-tilte\">\n              <span class=\"span1\">{{ itm.companyName }}</span>\n              <span\n                v-if=\"PermissionObj['callon_update'] != undefined\"\n                class=\"span2 theme-colors\"\n                @click.stop=\"routerTo(itm,1)\"\n              >编辑</span>\n            </div>\n            <div class=\"tab5-list-p\">\n              <span class=\"tab5-list-p-label\">\n                拜访内容:\n              </span>\n              <span\n                class=\"tab5-list-p-value\"\n                style=\"line-height: 19px;\"\n              >\n                {{ itm.visitContent }}\n              </span>\n            </div>\n            <div class=\"tab5-list-p\">\n              <span class=\"tab5-list-p-label\">\n                签到人:\n              </span>\n              <span class=\"tab5-list-p-value\">\n                <span>{{ itm.visitName }}</span>\n                <span>{{ itm.updateTime }}</span>\n              </span>\n            </div>\n          </div>\n        </van-list>\n      </div>\n\n      <div\n        v-if=\"PermissionObj['callon_insert'] != undefined\"\n        class=\"tab-footer\"\n      >\n        <van-button\n          class=\"gradual-btn\"\n          style=\"width:100%;\"\n          type=\"primary\"\n          to=\"/addVisit\"\n        >\n          新建拜访\n        </van-button>\n      </div>\n    </div>\n\n    <!-- tab5时间选择 -->\n    <van-popup\n      v-model=\"selectTime\"\n      position=\"bottom\"\n      :overlay=\"true\"\n    >\n      <van-datetime-picker\n        v-model=\"searchDate\"\n        type=\"date\"\n        :max-date=\"maxDate\"\n        :formatter=\"formatter\"\n        @confirm=\"startconfirm($event)\"\n        @cancel=\"startconfirm()\"\n      />\n    </van-popup>\n  </div>\n</template>\n<script>\n// import { api, get } from \"@api\";\n// import { mapState, mapMutations } from 'vuex'\nimport { VisitList } from '@/service/customer'\nimport { formatDate, isNull } from '@/utils'\n\nexport default {\n  name: 'Visit',\n  data() {\n    return {\n      PermissionObj:this.$store.state.powerList.PermissionObj,///权限\n      selectTime: false,\n      searchDate:new Date(),\n      maxDate: new Date(),\n      selectTimeStr: '',\n      VTList: [],\n      total: null,\n      page: 1,\n      size: 5,\n      tabIndex: 1,\n      loading: false,\n      finished: false,\n      finished_text: '没有更多数据啦',\n      error: false,\n      searchObj: null,\n      visitName:''\n    }\n  },\n  computed: {},\n  created() {\n    // this.getVisitList()\n  },\n  methods: {\n    clearTime(){\n      this.selectTimeStr = null\n      this.initList()\n    },\n    formatter(type, value) {\n      if (type === 'year') {\n        return `${value}年`\n      } if (type === 'month') {\n        return `${value}月`\n      }\n      return `${value}日`\n    },\n    showSelectTime() {\n      this.selectTime = !this.selectTime\n    },\n    startconfirm(e) {\n      if (isNull(e)) {\n        this.selectTime = false\n      } else {\n        const time = formatDate(new Date(e), 'yyyy-MM-dd')\n        console.log('time',time)\n        this.selectTimeStr = time\n        this.selectTime = false\n        this.searchChange()\n      }\n    },\n    // 获取拜访列表\n    getVisitList() {\n      const params = {\n        userId: this.$store.getters.userInfo.id,\n        visitName:this.visitName,\n        visitTime:this.selectTimeStr,\n        page:this.page,\n        size:this.size\n      }\n      VisitList(params).then((res) => {\n        console.log('getVisitList', res)\n        this.VTList = this.VTList.concat(res.data.data)\n        this.total = res.data.total\n        this.page += 1\n        this.loading = false// 加载状态结束\n      })\n    },\n    // 加载数据\n    onLoad(searchObj) {\n      const that = this\n      if (this.VTList.length === this.total) {\n        this.finished = true // 数据全部加载完成\n        this.loading = false// 加载状态结束\n        return\n      }\n      searchObj = searchObj || this.searchObj\n      // 下拉加载事件\n      if (that.tabIndex === 1) {\n        setTimeout(() => {\n          that.getVisitList(searchObj)\n        }, 1000)\n      }\n    },\n    //初始化列表配置\n    initList(){\n      this.total = null\n      this.page = 1\n      this.loading = true// 加载状态结束\n      this.VTList = []\n      this.onLoad()\n    },\n    //formChange\n    searchChange(){\n      this.initList()\n    },\n    //\n    routerTo(itm,OTP) {\n      if(itm.createUserId!=this.$store.getters.userInfo.id&&OTP==1){\n        this.$toast('非拜访创建人无权编辑该拜访！')\n        return\n      }\n      this.$router.push({\n        path: '/addVisit',\n        query: {\n          id:itm.visitId,\n          OTP\n        },\n      })\n    },\n  },\n}\n</script>\n<style lang=\"less\" scoped>\n.contact_container5 {\n  width: 100%;\n  padding: 10px 10px 70px 10px;\n  box-sizing: border-box;\n  background: #fcfcfc;\n  .tab5_box {\n    width: 100%;\n    .tab5-search {\n      width: 100%;\n      height: 32px;\n      margin-bottom: 10px;\n      display: flex;\n      select {\n        width: 50%;\n        display: block;\n        height: 32px;\n        border: 1px solid #999999;\n        border-radius: 1px;\n        padding-left: 10px;\n        outline: none;\n        appearance: none;\n        -moz-appearance: none;\n        -webkit-appearance: none;\n        -ms-appearance: none;\n        background: #ffffff;\n        margin-right: 5px;\n        color: #999999;\n        font-size: 12px;\n      }\n      .selectTime {\n        width: 50%;\n        display: flex;\n        // display: block;\n        justify-content: space-between;\n        height: 30px;\n        line-height: 30px;\n        border: 1px solid #999999;\n        border-radius: 1px;\n        padding-left: 10px;\n        box-sizing: border-box;\n        margin-left: 5px;\n        color: #999999;\n        font-size: 12px;\n      }\n      .clearTime{\n        margin-right:10px;\n        line-height: 30px;\n      }\n    }\n    .tab5-list {\n      width: 100%;\n      background: #ffffff;\n      box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);\n      border-radius: 5px;\n      padding: 10px 20px;\n      box-sizing: border-box;\n      margin-bottom: 15px;\n      position: relative;\n      .tab5-list-tilte {\n        width: 100%;\n        height: 35px;\n        line-height: 35px;\n        margin-bottom: 15px;\n        display: flex;\n        justify-content: space-between;\n        .span1 {\n          font-size: 16px;\n          color: #333333;\n          font-weight: bold;\n          \n        }\n        .span2 {\n          font-size: 12px;\n          color: #999999;\n          \n        }\n      }\n      .tab5-list-p {\n        width: 100%;\n        margin-bottom: 10px;\n        display: flex;\n        .tab5-list-p-label {\n         \n          font-size: 14px;\n          color: #999999;\n        }\n        .tab5-list-p-value {\n          // width: 100%;\n          font-size: 14px;\n          color: #999999;\n        }\n      }\n      .tab5-list-p1 {\n        font-size: 14px;\n        color: #999999;\n      }\n    }\n  }\n}\n.tab-footer {\n  width: 100%;\n  height: 70px;\n  background: #fcfcfc;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  padding: 0 10px;\n  box-sizing: border-box;\n}\n</style>\n"]}]}