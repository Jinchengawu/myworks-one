{"remainingRequest":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/thread-loader/dist/cjs.js!/Users/wangzhanyuan/code/oc-works/fuli/node_modules/babel-loader/lib/index.js!/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhanyuan/code/oc-works/fuli/src/views/addSign/addSign.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhanyuan/code/oc-works/fuli/src/views/addSign/addSign.vue","mtime":1564134165923},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.function.name\";\nimport _JSON$stringify from \"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport _objectSpread from \"/Users/wangzhanyuan/code/oc-works/fuli/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// import { api, get, post } from \"@/service\";\nimport { mapState } from 'vuex';\nimport { formatDate, isNull } from '@/utils';\nimport { addProject, projectList, idProject, upload } from '@/service/customer';\nimport addVisit from '../addVisit/addVisit.vue';\nexport default {\n  name: 'AddSign',\n  // components: {\n  //   'add-visit': addVisit,\n  // },\n  props: {\n    workType: {\n      type: Number,\n      default: null\n    },\n    upIng: {\n      type: Boolean,\n      default: false\n    },\n    //事件标识\n    isNo: {\n      type: Number,\n      default: 1\n    }\n  },\n  data: function data() {\n    return {\n      project: -1,\n      // 所属项目\n      price: '',\n      // 合约金额\n      memo: '',\n      // 备注\n      visitIndex: -1,\n      // 关联拜访\n      selectStartTime: false,\n      maxDate: new Date(),\n      minDate: new Date(1900, 1, 1),\n      currentTime: new Date(),\n      EventsData: {\n        projectName: '',\n        // 项目名称\n        contractAmount: '',\n        // 合同金额\n        remark: '',\n        // 备注\n        visitId: '',\n        // 关联拜访Id\n        signingTime: '',\n        // 签约时间（yyyy-MM-dd）\n        tuneUpEnclosure: '',\n        // 上传附件的URL\n        projectId: ''\n      },\n      pgList: [],\n      upType: 1,\n      isCDT: false,\n      visitDTO: null,\n      newFile: '',\n      OTP: false //当前打开该详情的状态\n\n    };\n  },\n  computed: _objectSpread({}, mapState(['companyName'])),\n  watch: {\n    upIng: function upIng(newV, oldV) {\n      var _this = this;\n\n      console.log('upIng', newV, oldV);\n      this.pgList.map(function (d) {\n        _this.EventsData.projectId = d.information.projectName == _this.EventsData.projectName ? d.id : _this.EventsData.projectId;\n      });\n      var txts = {\n        contractAmount: '合同金额',\n        signingTime: '签约时间'\n      };\n\n      if (!this.$checkFrom(this.EventsData, txts)) {\n        return;\n      }\n\n      var params = {\n        information: _JSON$stringify(this.EventsData),\n        \"menuType\": 5,\n        \"companyId\": this.$route.query.id,\n        \"projectId\": this.EventsData.projectId,\n        \"userId\": this.$store.getters.userInfo.id,\n        \"userName\": this.$store.getters.userInfo.name,\n        isNo: this.isNo\n      };\n      this.$emit('upedChange', params);\n      return;\n    }\n  },\n  mounted: function mounted() {},\n  created: function created() {\n    this.getProjectList();\n\n    if (this.$route.query.id) {\n      this.getIdProject(this.$route.query.id);\n      this.upType = 2;\n      this.OTP = true; //当前打开该详情的状态\n    }\n\n    this.EventsData.companyName = this.$store.getters.userData.companyName;\n    this.EventsData.companyId = this.$store.getters.userData.companyId;\n  },\n  methods: {\n    //确定事件\n    addSet: function addSet() {\n      if (this.EventsData.visitId == 1) {\n        this.isCDT = !this.isCDT;\n      } else {\n        console.log('签约签约签约');\n        this.clickAddEvents();\n      }\n    },\n    //监听回收数据\n    watchVisit: function watchVisit(e) {\n      console.log('监听回收数据', e);\n      this.visitDTO = e;\n      this.clickAddEvents();\n    },\n    //根据id获取目标详情\n    getIdProject: function getIdProject(id) {\n      var _this2 = this;\n\n      idProject({\n        id: id\n      }).then(function (res) {\n        // console.log('idProject',res)\n        _this2.EventsData = res.information;\n      });\n    },\n    getProjectList: function getProjectList() {\n      var _this3 = this;\n\n      var params = {\n        menuType: 1,\n        size: 1000\n      };\n      projectList(params).then(function (res) {\n        console.log('projectList', res);\n        _this3.pgList = res.data;\n\n        if (res.data.length > 0) {\n          if (_this3.EventsData.projectName) {\n            return;\n          }\n\n          _this3.EventsData.projectName = res.data[0].information.projectName;\n        }\n      });\n    },\n    clickAddEvents: function clickAddEvents() {\n      var _this4 = this;\n\n      var EventsData = {};\n      this.pgList.map(function (d) {\n        _this4.EventsData.projectId = d.information.projectName == _this4.EventsData.projectName ? d.id : _this4.EventsData.projectId;\n      });\n      var txts = {\n        contractAmount: '合同金额',\n        signingTime: '签约时间'\n      };\n\n      if (!this.$checkFrom(this.EventsData, txts)) {\n        return;\n      }\n\n      EventsData.information = _JSON$stringify(this.EventsData);\n      EventsData.menuType = 5;\n      EventsData.projectId = this.EventsData.projectId;\n      EventsData.visitDTO = this.visitDTO;\n      console.log('签约签约签约');\n      addProject(EventsData).then(function (res) {\n        console.log(res);\n\n        if (res.text == \"error\") {\n          _this4.$notify(res.message);\n\n          return;\n        }\n\n        _this4.$router.go(-1);\n      });\n    },\n    formatter: function formatter(type, value) {\n      if (type === 'year') {\n        return \"\".concat(value, \"\\u5E74\");\n      }\n\n      if (type === 'month') {\n        return \"\".concat(value, \"\\u6708\");\n      }\n\n      return \"\".concat(value, \"\\u65E5\");\n    },\n    startTimeClick: function startTimeClick() {\n      this.selectStartTime = true;\n    },\n    startconfirm: function startconfirm(e) {\n      // 选开始时间\n      if (isNull(e)) {\n        this.selectStartTime = false;\n      } else {\n        var time = formatDate(new Date(e), 'yyyy-MM-dd', 'special');\n        var timeStr = time.split('-');\n        this.EventsData.signingTime = \"\".concat(timeStr[0], \"-\").concat(timeStr[1], \"-\").concat(timeStr[2]);\n        this.selectStartTime = false;\n      }\n    },\n    update: function update(e) {\n      var _this5 = this;\n\n      var file = e.target.files[0];\n      var param = new FormData();\n      param.append('file', file);\n      var userData = this.$store.getters.userData;\n      var fileName = userData.companyAbbreviation + '-' + userData.companyBusinessLicense + '-' + formatDate(new Date(), 'yyyyMMdd');\n      var config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      upload(param, config).then(function (res) {\n        console.log('上传文件', res.data);\n\n        _this5.$notifySty('上传成功');\n\n        _this5.newFile = res.data.url;\n        _this5.EventsData.fileName = fileName;\n        _this5.EventsData.fileUrl = res.data.url;\n      });\n    }\n  }\n};",{"version":3,"sources":["addSign.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"addSign\">\n    <div class=\"container\">\n      <van-cell-group :border=\"false\">\n        <van-field\n          v-model=\"EventsData.companyName\"\n          label=\"客户\"\n          type=\"text\"\n          input-align=\"right\"\n          placeholder=\"请输入\"\n          :error=\"false\"\n          :border=\"false\"\n          :readonly=\"true\"\n        />\n\n        <div class=\"select-list\">\n          <div class=\"list\">\n            <div class=\"left\">\n              所属项目\n            </div>\n            <div class=\"right\">\n              <select\n                v-model=\"EventsData.projectName\"\n                v-placeholder=\"{color: EventsData.projectName}\"\n                :disabled=\"OTP\"\n              >\n                <option\n                  v-for=\"(item,idx) in pgList\"\n                  :key=\"idx\"\n                  :value=\"item.information.projectName\"\n                >\n                  {{ item.information.projectName }}\n                </option>\n              </select>\n            </div>\n            <div\n              v-sanjiao=\"{color: EventsData.projectName}\"\n              class=\"saojiao\"\n            />\n          </div>\n        </div>\n\n        <div\n          v-if=\"upType!=2\"\n          class=\"select-list\"\n        >\n          <div\n            class=\"list\"\n            @click=\"startTimeClick()\"\n          >\n            <div class=\"left\">\n              时间\n            </div>\n            <div\n              class=\"right\"\n              :class=\"{'selectPlaceholder':EventsData.signingTime== ''}\"\n            >\n              {{ EventsData.signingTime== '' ? '请选择' : EventsData.signingTime }}\n            </div>\n            <div class=\"timeBox\">\n              <span\n                class=\"iconfont iconrili\"\n                style=\"color:#aebab4\"\n              />\n            </div>\n          </div>\n        </div>\n        <van-field\n          v-else\n          v-model=\"EventsData.signingTime\"\n          label=\"时间\"\n          \n          input-align=\"right\"\n          placeholder=\"请输入\"\n          :error=\"false\"\n          :border=\"false\"\n          :readonly=\"upType==2\"\n        />\n        <div class=\"money-text\">\n          <van-field\n            v-model=\"EventsData.contractAmount\"\n            style=\"width:90%;\"\n            label=\"合约金额\"\n            type=\"number\"\n            input-align=\"right\"\n            placeholder=\"请输入合约金额 单位:\"\n            :error=\"false\"\n            :border=\"false\"\n            :readonly=\"upType==2\"\n          />\n          <span class=\"right-text\">万元</span>\n        </div>\n\n        <van-field\n          v-model=\"EventsData.remark\"\n          label=\"备注\"\n          type=\"textarea\"\n          input-align=\"right\"\n          placeholder=\"请输入\"\n          rows=\"1\"\n          autosize\n          :border=\"false\"\n          :readonly=\"upType==2\"\n        />\n\n        <div\n          v-if=\"upType!=2\"\n          class=\"select-map\"\n        >\n          <div class=\"uploadFile\">\n            <span class=\"iconfont iconshangchuan uploadIcon\" />\n            <input\n              class=\"file\"\n              name=\"file\"\n              type=\"file\"\n              @change=\"update\"\n            >\n            <div class=\"uploadText\">\n              点击上传附件\n            </div>\n          </div>\n        </div>\n        <div style=\"width: 50%;overflow: hidden;margin-left: 10px;\">\n          {{ newFile }}\n        </div>\n        <div\n          v-if=\"upType!=2\"\n          class=\"select-list\"\n        >\n          <div\n            v-if=\"workType!=3\"\n            class=\"list\"\n          >\n            <div class=\"left\">\n              关联拜访\n            </div>\n            <div class=\"right\">\n              <select\n                v-model=\"EventsData.visitId\"\n                v-placeholder=\"{color: EventsData.visitId}\"\n                :disabled=\"OTP\"\n              >\n                <option value=\"\">\n                  否\n                </option>\n                <option value=\"1\">\n                  是\n                </option>                \n              </select>\n            </div>\n            <div\n              v-sanjiao=\"{color: EventsData.visitId}\"\n              class=\"saojiao\"\n            />\n          </div>\n        </div>\n        <add-visit\n          v-if=\"EventsData.visitId==1&&upType!=2\"\n          :is-c-d-t=\"isCDT\"\n          :is-c-p-t=\"true\"\n          @VisitChange=\"watchVisit\"\n        />\n      </van-cell-group>\n\n      <div class=\"footer\">\n        <van-button\n          v-if=\"upType!=2\"\n          class=\"gradual-btn\"\n          style=\"width:100%;\"\n          type=\"primary\"\n          @click=\"addSet\"\n        >\n          确认信息\n        </van-button>\n      </div>\n    </div>\n\n    <!--  时间选择 -->\n    <van-popup\n      v-model=\"selectStartTime\"\n      position=\"bottom\"\n      :overlay=\"true\"\n    >\n      <van-datetime-picker\n        v-model=\"currentTime\"\n        type=\"date\"        \n        :min-date=\"minDate\"\n        :formatter=\"formatter\"\n        @confirm=\"startconfirm($event)\"\n        @cancel=\"startconfirm()\"\n      />\n    </van-popup>\n  </div>\n</template>\n<script>\n// import { api, get, post } from \"@/service\";\nimport { mapState } from 'vuex'\nimport { formatDate, isNull } from '@/utils'\nimport { addProject,projectList,idProject,upload } from '@/service/customer'\nimport addVisit from '../addVisit/addVisit.vue'\nexport default {\n  name: 'AddSign',\n  // components: {\n  //   'add-visit': addVisit,\n  // },\n  props:{\n    workType:{\n      type:Number,\n      default:null\n    },\n    upIng: {\n      type: Boolean,\n      default: false\n    },\n    //事件标识\n    isNo:{\n      type:Number ,\n      default:1\n    },\n  },\n  data() {\n    return {\n      project: -1, // 所属项目\n      price: '', // 合约金额\n      memo: '', // 备注\n      visitIndex: -1, // 关联拜访\n      selectStartTime: false,\n      maxDate: new Date(),\n      minDate: new Date(1900, 1, 1),\n      currentTime: new Date(),\n      EventsData: {\n        projectName: '', // 项目名称\n        contractAmount: '', // 合同金额\n        remark: '', // 备注\n        visitId: '', // 关联拜访Id\n        signingTime: '', // 签约时间（yyyy-MM-dd）\n        tuneUpEnclosure: '', // 上传附件的URL\n        projectId:'',\n      },\n      pgList:[],\n      upType:1,\n      isCDT:false,\n      visitDTO:null,\n      newFile:'',\n      OTP:false,//当前打开该详情的状态\n    }\n  },\n  computed: {\n    ...mapState(['companyName']),\n  },\n  watch:{\n    upIng(newV,oldV){\n      console.log('upIng',newV,oldV)\n      this.pgList.map(d=>{\n        this.EventsData.projectId = d.information.projectName == this.EventsData.projectName ? d.id: this.EventsData.projectId\n      })\n      let txts = {                                \n        contractAmount:'合同金额',        \n        signingTime:'签约时间',  \n      }       \n      if (!this.$checkFrom(this.EventsData,txts)) {\n        return\n      }\n      let params = {\n        information:JSON.stringify(this.EventsData),\n        \"menuType\":5,\n\t\t    \"companyId\":this.$route.query.id,\n\t\t    \"projectId\":this.EventsData.projectId,\n\t\t    \"userId\":this.$store.getters.userInfo.id,\n        \"userName\":this.$store.getters.userInfo.name,\n        isNo:this.isNo\n      }\n      this.$emit('upedChange',params)\n      \n      return\n    },\n  },\n  mounted() { },\n\n  created() { \n    this.getProjectList()\n    if(this.$route.query.id){\n      this.getIdProject(this.$route.query.id)\n      this.upType =2\n      this.OTP=true//当前打开该详情的状态\n    }\n    \n    this.EventsData.companyName=this.$store.getters.userData.companyName\n    this.EventsData.companyId= this.$store.getters.userData.companyId\n  },\n  methods: {\n    //确定事件\n    addSet(){      \n      if(this.EventsData.visitId==1){\n        this.isCDT = !this.isCDT\n      }else{\n        console.log('签约签约签约')\n        this.clickAddEvents()\n      }\n    },\n    //监听回收数据\n    watchVisit(e){\n      console.log('监听回收数据',e)\n      this.visitDTO = e\n      this.clickAddEvents()\n    },\n    //根据id获取目标详情\n    getIdProject(id){\n      idProject({id:id}).then(res=>{\n        // console.log('idProject',res)\n        this.EventsData = res.information\n      })\n    },\n    getProjectList() {\n      const params = {\n        menuType: 1,\n        size:1000\n      }\n      projectList(params).then((res) => {\n        console.log('projectList', res)\n        this.pgList = res.data\n        if(res.data.length>0){\n          if(this.EventsData.projectName){\n            return\n          }\n          this.EventsData.projectName = res.data[0].information.projectName\n        }\n      })\n    },\n    clickAddEvents() {\n      const EventsData = {}\n      this.pgList.map(d=>{\n        this.EventsData.projectId = d.information.projectName == this.EventsData.projectName ? d.id: this.EventsData.projectId\n      })\n      let txts = {                                \n        contractAmount:'合同金额',        \n        signingTime:'签约时间',  \n      }       \n      if (!this.$checkFrom(this.EventsData,txts)) {\n        return\n      }\n      EventsData.information = JSON.stringify(this.EventsData) \n      EventsData.menuType = 5\n      EventsData.projectId = this.EventsData.projectId\n      EventsData.visitDTO = this.visitDTO\n      console.log('签约签约签约')\n      addProject(EventsData).then(res=>{\n        console.log(res)\n        if(res.text==\"error\"){\n          this.$notify(res.message)\n          return \n        }\n        this.$router.go(-1)\n      })\n    },\n    formatter(type, value) {\n      if (type === 'year') {\n        return `${value}年`\n      } if (type === 'month') {\n        return `${value}月`\n      }\n      return `${value}日`\n    },\n    startTimeClick() {\n      this.selectStartTime = true\n    },\n    startconfirm(e) {\n      // 选开始时间\n      if (isNull(e)) {\n        this.selectStartTime = false\n      } else {\n        const time = formatDate(new Date(e), 'yyyy-MM-dd', 'special')\n        const timeStr = time.split('-')\n        this.EventsData.signingTime = `${timeStr[0]}-${timeStr[1]}-${timeStr[2]}`\n        this.selectStartTime = false\n      }\n    },\n    update(e) {\n      let file = e.target.files[0]\n      let param = new FormData()\n      param.append('file', file)\n      let userData = this.$store.getters.userData\n      let fileName = userData.companyAbbreviation+'-'+userData.companyBusinessLicense+'-'+ formatDate(new Date(),'yyyyMMdd')\n      let config = {\n        headers: { 'Content-Type': 'multipart/form-data' }\n      }\n      upload(param, config)\n        .then(res => {\n          console.log('上传文件', res.data)\n          this.$notifySty('上传成功')\n          this.newFile = res.data.url\n          this.EventsData.fileName = fileName\n          this.EventsData.fileUrl = res.data.url\n        })\n    }\n  },\n}\n</script>\n<style lang=\"less\" scoped>\n.container {\n  .file{\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    opacity: 0;\n    cursor: pointer;\n  }\n  width: 100%;\n  padding-bottom: 100px;\n  .select-map {\n    width: 100%;\n    padding: 0px 15px 0px 15px;\n    box-sizing: border-box;\n    .title-header {\n      width: 80%;\n      height: 40px;\n      line-height: 40px;\n      background-color: #fff;\n      color: #323233;\n      font-size: 14px;\n      color: #323233;\n      font-size: 14px;\n      padding-right: 15px;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    .body {\n      width: 100%;\n      height: 240px;\n      background: #f4f4f4;\n    }\n    .uploadFile {\n      width: 100px;\n      height: 100px;\n      border: 1px dashed #979797;\n      position: relative;\n      .uploadIcon {\n        font-size: 30px;\n        position: absolute;\n        top: 15px;\n        left: 35px;\n        color: #979797;\n      }\n      .uploadText {\n        width: 65px;\n        font-size: 16px;\n        position: absolute;\n        top: 50px;\n        left: 20px;\n        color: #979797;\n      }\n    }\n  }\n  .select-list {\n    width: 100%;\n    padding: 0px 0px 0px 15px;\n    box-sizing: border-box;\n    .addborder {\n      border-bottom: 1px solid #f5f6f8;\n    }\n    .list {\n      width: 100%;\n      height: 40px;\n      display: flex;\n      line-height: 40px;\n      background-color: #fff;\n      color: #323233;\n      font-size: 14px;\n      overflow: hidden;\n      color: #323233;\n      font-size: 14px;\n      box-sizing: border-box;\n      padding-right: 15px;\n      .left {\n        max-width: 90px;\n        height: 40px;\n      }\n      .right {\n        flex: 1;\n        height: 40px;\n        text-align: right;\n        select {\n          width: 100%;\n          height: 40px;\n          text-align: right;\n          border: none;\n          outline: none;\n          appearance: none;\n          -moz-appearance: none;\n          -webkit-appearance: none;\n          -ms-appearance: none;\n          direction: rtl;\n          text-indent: 5px;\n          background: #ffffff;\n        }\n      }\n    }\n    .saojiao {\n      width: 0;\n      height: 0;\n      border-width: 6px;\n      border-style: solid;\n      border-color: #323233 transparent transparent transparent;\n      margin-top: 17px;\n    }\n    .timeBox {\n      width: 25px;\n      height: 40px;\n      text-align: right;\n    }\n  }\n  .show-more {\n    width: 100%;\n    height: 40px;\n    line-height: 40px;\n    font-size: 12px;\n    color: #999999;\n    text-align: center;\n    .downIcon {\n      font-size: 8px;\n      position: relative;\n      left: 3px;\n      top: -1px;\n    }\n  }\n  .footer {\n    width: 100%;\n    height: 70px;\n    background: #fcfcfc;\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    padding: 0 10px;\n    box-sizing: border-box;\n  }\n}\n</style>\n"],"sourceRoot":"src/views/addSign"}]}