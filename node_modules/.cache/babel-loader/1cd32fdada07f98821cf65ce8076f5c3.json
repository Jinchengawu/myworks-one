{"remainingRequest":"/Users/wangzhanyuan/code/my-works/one/node_modules/babel-loader/lib/index.js!/Users/wangzhanyuan/code/my-works/one/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhanyuan/code/my-works/one/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhanyuan/code/my-works/one/src/views/AfterLoanManagement/loadTwo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhanyuan/code/my-works/one/src/views/AfterLoanManagement/loadTwo.vue","mtime":1564134165915},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// import { api, get } from \"@api\";\n// import { mapState, mapMutations } from 'vuex'\nimport { formatDate, isNull } from '@/utils';\nimport { rentBackFilePage, updateRentBackFileById, addSearonCheck, sendTextCardMessage, lendingInfoConfirm, getLendingInfoConfirm } from '@/service/loan.js';\nimport { upload } from '@/service/customer';\nexport default {\n  name: 'LoadTwo',\n  data: function data() {\n    return {\n      PermissionObj: this.$store.state.powerList.PermissionObj,\n      ///权限\n      showMoreBox: false,\n      LoanedList: [],\n      totalLog: null,\n      loadingLog: false,\n      finishedLog: false,\n      finished_text: '',\n      error: false,\n      pageLog: 1,\n      size: 5,\n      isQuarter: 1,\n      //当前选择季度\n      active: 1,\n      newFile: null,\n      //上传文件寄存\n      nowUpType: true,\n      //当前的上传状态\n      newYear: '2019',\n      //当前年份\n      yearList: ['2017', '2018', '2019', '2020'],\n      show: false\n    };\n  },\n  computed: {},\n  created: function created() {\n    this.selectInput = '777';\n    console.log(this.isQuarter, this.newYear, this.$route.query.id);\n    this.getNowUpType('get'); //查询上传状态\n  },\n  methods: {\n    update: function update(e) {\n      var _this = this;\n\n      var file = e.target.files[0];\n      var param = new FormData();\n      param.append('file', file);\n      var config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$toast.loading({\n        mask: true,\n        message: '上传中...',\n        duration: 100000\n      });\n      upload(param, config).then(function (res) {\n        var name = file.name;\n        console.log(name); // console.log('文件相关',param, )\n\n        _this.fileTypeName = name.slice(name.lastIndexOf('.'), name.length);\n        console.log('上传文件', param);\n        _this.newFile = res.data;\n\n        _this.$toast.clear();\n\n        _this.addSearon();\n      });\n    },\n    //新增季度检查\n    addSearon: function addSearon() {\n      var _this2 = this;\n\n      if (!this.newFile) return;\n      var userData = this.$store.getters.userData;\n      var fileName = userData.companyAbbreviation + '-' + userData.companyBusinessLicense + '-' + formatDate(new Date(), 'yyyyMMdd');\n      var params = {\n        fileName: fileName + this.fileTypeName,\n        filePath: this.newFile.url,\n        projectId: this.$route.query.projectId,\n        fileType: 0,\n        lendingId: this.$route.query.id,\n        timeQuarter: this.isQuarter\n      };\n      addSearonCheck(params).then(function (res) {\n        console.log('新增季度检查', res);\n\n        _this2.$notifySty('添加成功');\n\n        _this2.changeIdx(_this2.isQuarter, 'get');\n      });\n    },\n    //季度选择改变\n    changeIdx: function changeIdx(idx, type) {\n      console.log('//季度选择改变', idx);\n      this.newFile = {};\n      this.isQuarter = idx;\n      this.pageLog = 1;\n      this.size = 5;\n      this.totalLog = null;\n      this.$set(this, 'LoanedList', []);\n      this.loadingLog = true; // 加载状态结束\n\n      this.finished_text = '';\n      this.getNowUpType(type);\n      this.onLoad();\n    },\n    boxShow: function boxShow(itm) {\n      this.show = !this.show;\n      if (!this.show) this.delItm = null;else this.delItm = itm;\n      console.log('this.delItm', this.delItm);\n    },\n    //'删除文件'\n    deleteFile: function deleteFile() {\n      var _this3 = this;\n\n      // console.log('this.delItm',this.delItm)\n      updateRentBackFileById({\n        id: this.delItm.id\n      }).then(function (res) {\n        // console.log('删除文件',res)\n        _this3.LoanedList.map(function (d, idx) {\n          if (d.id == _this3.delItm.id) {\n            _this3.LoanedList.splice(idx, 1);\n          }\n\n          _this3.boxShow();\n        });\n      });\n    },\n    //下载\n    download: function download(itm) {\n      console.log('itm', itm);\n      var baseUrl = this.$baseUrl() + itm.filePath + '&filename=' + itm.fileName;\n      window.open(baseUrl);\n    },\n    // 加载数据\n    onLoad: function onLoad() {\n      var that = this; // console.log(this.LoanedList.length , this.totalLog)\n\n      if (this.LoanedList.length === this.totalLog) {\n        this.finishedLog = true; // 数据全部加载完成\n\n        this.loadingLog = false; // 加载状态结束\n\n        this.finished_text = '没有更多数据';\n        return;\n      } // 下拉加载事件\n\n\n      setTimeout(function () {\n        that.getLoanedList();\n      }, 1000);\n    },\n    //获取当前数据列表\n    getLoanedList: function getLoanedList() {\n      var _this4 = this;\n\n      // console.log('季度检查list111', this.totalLog)\n      var params = {\n        projectId: this.$route.query.projectId,\n        fileType: 0,\n        page: this.pageLog,\n        size: this.size,\n        timeQuarter: this.isQuarter,\n        createTime: this.newYear\n      };\n      rentBackFilePage(params).then(function (res) {\n        // console.log('季度检查list222',this.totalLog)\n        _this4.loadingLog = false; // 加载状态结束\n\n        _this4.totalLog = res.total;\n\n        if (res.total == 0) {\n          _this4.finished_text = '没有更多数据';\n          return;\n        }\n\n        _this4.LoanedList = _this4.LoanedList.concat(res.data);\n        _this4.pageLog += 1;\n      });\n    },\n    //贷后提醒发送\n    callLoad: function callLoad() {\n      var _this5 = this;\n\n      var params = {\n        lendingInfoId: this.$route.query.id\n      };\n      sendTextCardMessage(params).then(function (res) {\n        _this5.$notifySty('提醒已发送');\n\n        console.log(res);\n        _this5.sendMessage = res.data;\n        _this5.sendMessage.paramInfo = JSON.parse(_this5.sendMessage.paramInfo);\n        _this5.sendMessage.sendInfo = JSON.parse(_this5.sendMessage.sendInfo);\n        _this5.sendMessage.date = formatDate(new Date(), 'yyyy-MM-dd hh:mm:ss');\n        console.log(_this5.sendMessage);\n        _this5.showMoreBox = true; // this.sendMessage.wechatInfo = JSON.parse(this.sendMessage.wechatInfo)\n      });\n    },\n    //查询当前季度上传文件状态\n    getNowUpType: function getNowUpType(type) {\n      var _this6 = this;\n\n      var params = {\n        lendingInfoId: this.$route.query.id,\n        year: this.newYear,\n        timeQuarter: this.isQuarter\n      };\n\n      if (type == 'get') {\n        getLendingInfoConfirm(params).then(function (res) {\n          _this6.nowUpType = res.data;\n        });\n      } else {\n        lendingInfoConfirm(params).then(function (res) {\n          _this6.nowUpType = res.data;\n        });\n      }\n    },\n    //年份变化\n    changeYear: function changeYear() {\n      this.changeIdx(this.isQuarter, 'get');\n    },\n    showMore: function showMore() {\n      this.showMoreBox = !this.showMoreBox;\n    }\n  }\n};",{"version":3,"sources":["loadTwo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div\n    name=\"loadTwo\"\n    class=\"loadTwo\"\n  >\n    <div class=\"year-tab\">\n      <van-popup\n        v-model=\"show\"\n        class=\"Tit-box\"\n      >\n        <div class=\"Tit-box-title\">\n          提示\n        </div>\n        <div class=\"Tit-box-cont\">\n          确认删除？\n        </div>\n        <div class=\"Tit-box-buts\">\n          <van-button\n            class=\"Tit-box-but\"\n            type=\"primary\"\n            square\n            @click=\"deleteFile\"\n          >\n            确认\n          </van-button>\n          <van-button\n            class=\"Tit-box-but\"\n            square\n            @click=\"boxShow\"\n          >\n            取消\n          </van-button>\n        </div>\n      </van-popup>\n      <van-row>\n        <van-col span=\"6\">\n          <span\n            :class=\"{'theme-colors':isQuarter==1}\"\n            @click=\"changeIdx(1,'get')\"\n          >第一季度</span>\n        </van-col>\n        <van-col span=\"6\">\n          <span\n            :class=\"{'theme-colors':isQuarter==2}\"\n            @click=\"changeIdx(2,'get')\"\n          >半年度</span>\n        </van-col>\n        <van-col span=\"6\">\n          <span\n            :class=\"{'theme-colors':isQuarter==3}\"\n            @click=\"changeIdx(3,'get')\"\n          >第三季度</span>\n        </van-col>\n        <van-col span=\"6\">\n          <span\n            :class=\"{'theme-colors':isQuarter==4}\"\n            @click=\"changeIdx(4,'get')\"\n          >整年度</span>\n        </van-col>\n      </van-row>\n    </div>\n    <div class=\"contact_container5\">\n      <van-list\n        v-model=\"loadingLog\"\n        :finished=\"finishedLog\"\n        :finished-text=\"finished_text\"\n        :error.sync=\"error\"\n        error-text=\"请求失败，点击重新加载\"\n        @load=\"onLoad()\"\n      >\n        <div class=\"tab5_box\">\n          <div class=\"tab5-count\">\n            <!-- <span>2019年</span> -->\n            <div\n              class=\"search-item\"\n              style=\"display:flex\"\n            >\n              <div class=\"left text-bold\">\n                请选择时间\n              </div>\n              <div\n                class=\"right\"\n                style=\"margin-left: 10px;\"\n              >\n                <select\n                  v-model=\"newYear\"  \n                  @change=\"changeYear\"                \n                >\n                  <option\n                    v-for=\"(itm,idx) in yearList\"\n                    :key=\"idx\"\n                    :value=\"itm\"\n                  >\n                    {{ itm }}\n                  </option>\n                </select>\n              </div>\n            </div>\n            <!-- <van-icon\n              name=\"arrow\"\n              style=\"position:relative;top:2px;\"\n            /> -->\n          </div>\n          <div\n            v-for=\"(itm,idx) in LoanedList\"\n            :key=\"idx\"\n            class=\"tab5-list\"\n          > \n            <div class=\"tab5-list-tilte\">\n              <p class=\"span1\">\n                {{ itm.fileName }}\n              </p>\n              <p\n                class=\"span2\"\n                style=\"color:#999999;\"\n              >\n                {{ itm.createTime }}\n              </p>\n            </div>\n            <div class=\"tab5-list-p\">\n              所属项目:\n              {{ itm.information.projectName }}\n            </div>\n            <div class=\"tab5-list-p\">\n              <span class=\"span-left\">\n                上传人员:\n                {{ itm.name }}\n              </span>\n              <span class=\"span-right\">\n                <span\n                  class=\"iconfont iconicon_load theme-colors\"\n                  @click=\"download(itm)\"\n                />\n                <span\n                  class=\"iconfont iconshanchu theme-colors\"\n                  style=\"margin-left:10px;\"\n                  @click=\"boxShow(itm)\"\n                />\n              </span>\n            </div>\n          </div>              \n        </div>\n      </van-list>      \n    </div>\n\n    <div\n      v-if=\"showMoreBox\"\n      class=\"more-show-box\"\n    >\n      <p>该项目模板消息:已发送</p>\n      <p>发送时间:{{ sendMessage.date }}</p>\n      <p>确认人:{{ sendMessage.sendUsers }}</p>\n      <div class=\"message\" />\n      <div style=\"margin-bottom: 15px;margin-bottom: 15px;overflow: hidden;text-overflow: ellipsis;\">\n        模板消息接收人:{{ sendMessage.sendInfo.toUser }}\n      </div>\n      <div style=\"text-align: center;color: #555;\">\n        <p>{{ sendMessage.sendInfo.textCard.btnTxt }}</p>\n        <p>{{ sendMessage.sendInfo.textCard.description }}</p>\n        <p>{{ sendMessage.sendInfo.textCard.title }}</p>\n      </div>\n    </div>\n\n    <div class=\"kong\" />\n    <div class=\"footer\">\n      <van-row style=\"display:flex\">\n        <van-col\n          span=\"8\"\n          style=\"flex:1\"\n        >\n          <van-button\n            v-if=\"PermissionObj['loan_risk_confirm'] != undefined && !nowUpType\"\n            class=\"clear-btn\"\n            style=\"width:100%;\"\n            square\n            type=\"primary\"\n          >\n            上传资料\n          </van-button>\n          <input\n            v-if=\"PermissionObj['loan_risk_confirm'] != undefined && !nowUpType\"\n            class=\"file\"\n            name=\"file\"\n            type=\"file\"\n            @change=\"update\"\n          >\n        </van-col>\n        <van-col\n          span=\"8\"\n          style=\"flex:1\"\n        >\n          <van-button\n            v-if=\"!nowUpType\"\n            class=\"theme-background-colors\"\n            style=\"width:100%;\"\n            square\n            type=\"primary\"\n            @click=\"callLoad\"\n          >\n            提醒\n          </van-button>\n        </van-col>\n        <van-col\n          span=\"8\"\n          style=\"flex:1\"\n        >\n          <van-button\n            v-if=\"PermissionObj['loan_finance_confirm'] != undefined && !nowUpType\"\n            class=\"confirm-btn\"\n            style=\"width:100%;\"\n            square\n            type=\"primary\"\n            @click=\"getNowUpType('post')\"\n          >\n            确认完成\n          </van-button>\n        </van-col>\n      </van-row>\n    </div>\n  </div>\n</template>\n<script>\n// import { api, get } from \"@api\";\n// import { mapState, mapMutations } from 'vuex'\nimport { formatDate, isNull } from '@/utils'\nimport { rentBackFilePage,updateRentBackFileById,addSearonCheck,sendTextCardMessage,lendingInfoConfirm,getLendingInfoConfirm } from '@/service/loan.js'\nimport { upload  } from '@/service/customer'\nexport default {\n  name: 'LoadTwo',\n  data() {\n    return {\n      PermissionObj:this.$store.state.powerList.PermissionObj,///权限\n      showMoreBox: false,\n      LoanedList:[],\n      totalLog: null,\n      loadingLog: false,\n      finishedLog: false,\n      finished_text: '',\n      error: false,\n      pageLog: 1,\n      size: 5,\n      isQuarter:1,//当前选择季度\n      active:1,\n      newFile:null,//上传文件寄存\n      nowUpType:true,//当前的上传状态\n      newYear:'2019',//当前年份\n      yearList:['2017','2018','2019','2020'],\n      show:false\n    }\n  },\n  computed: {},\n  created() {\n    this.selectInput = '777'\n    console.log(this.isQuarter,this.newYear,this.$route.query.id)\n    this.getNowUpType('get')//查询上传状态\n  },\n  methods: {\n    update(e) {            \n      let file = e.target.files[0]      \n      let param = new FormData()\n      param.append('file', file)\n      \n      let config = {\n        headers: { 'Content-Type': 'multipart/form-data' }\n      }\n\n      this.$toast.loading({\n        mask: true,\n        message: '上传中...',\n        duration:100000\n      })\n      upload(param, config)\n        .then(res => {\n          let name = file.name\n          console.log(name)\n          // console.log('文件相关',param, )\n          this.fileTypeName = name.slice(name.lastIndexOf('.'),name.length)\n          console.log('上传文件',param)\n          this.newFile=res.data          \n          this.$toast.clear()\n          this.addSearon()\n        })\n    },\n    //新增季度检查\n    addSearon(){\n      if(!this.newFile) return\n      let userData = this.$store.getters.userData\n      let fileName = userData.companyAbbreviation+'-'+userData.companyBusinessLicense+'-'+ formatDate(new Date(),'yyyyMMdd')\n      let params = {\n        fileName:fileName+this.fileTypeName,\n        filePath:this.newFile.url,\n        projectId:this.$route.query.projectId,\n        fileType:0,\n        lendingId:this.$route.query.id,\n        timeQuarter:this.isQuarter,\n      }\n      addSearonCheck(params).then(res=>{\n        console.log('新增季度检查',res)\n        this.$notifySty('添加成功')\n        this.changeIdx(this.isQuarter,'get')\n      })\n    },\n    //季度选择改变\n    changeIdx(idx,type){\n      console.log('//季度选择改变',idx)\n      this.newFile={}\n      this.isQuarter = idx\n      this.pageLog = 1\n      this.size = 5\n      this.totalLog = null\n      this.$set(this,'LoanedList',[])\n      this.loadingLog = true// 加载状态结束\n      this.finished_text = ''\n      this.getNowUpType(type)\n      this.onLoad()\n    },\n    boxShow(itm){\n      this.show = !this.show\n      if(!this.show)this.delItm = null\n      else this.delItm = itm\n      console.log('this.delItm',this.delItm)\n    },\n    //'删除文件'\n    deleteFile(){\n      // console.log('this.delItm',this.delItm)\n      updateRentBackFileById({id:this.delItm.id}).then(res=>{\n        // console.log('删除文件',res)\n        this.LoanedList.map((d,idx)=>{\n          if(d.id==this.delItm.id){ \n            this.LoanedList.splice(idx,1)\n          }\n          this.boxShow()\n        })\n      })\n    },\n    //下载\n    download(itm){\n      console.log('itm',itm)\n      let baseUrl = this.$baseUrl()+itm.filePath+'&filename='+itm.fileName\n      window.open(baseUrl)\n    },\n    // 加载数据\n    onLoad() {\n      const that = this\n      // console.log(this.LoanedList.length , this.totalLog)\n      if (this.LoanedList.length === this.totalLog) {\n        this.finishedLog = true // 数据全部加载完成\n        this.loadingLog = false// 加载状态结束\n        this.finished_text = '没有更多数据'\n        return\n      }\n      // 下拉加载事件\n      setTimeout(() => {\n        that.getLoanedList()\n      }, 1000)      \n    },\n    //获取当前数据列表\n    getLoanedList() {\n      // console.log('季度检查list111', this.totalLog)\n      const params = {\n        projectId:this.$route.query.projectId,\n        fileType: 0,\n        page: this.pageLog,\n        size: this.size,\n        timeQuarter:this.isQuarter,\n        createTime:this.newYear\n      }\n      rentBackFilePage(params).then((res) => {\n        // console.log('季度检查list222',this.totalLog)\n        this.loadingLog = false// 加载状态结束\n        this.totalLog = res.total\n        if(res.total==0){\n          this.finished_text = '没有更多数据'\n          return\n        }\n        this.LoanedList = this.LoanedList.concat(res.data)\n        this.pageLog += 1\n      })\n    },   \n    //贷后提醒发送\n    callLoad(){\n      let params = {\n        lendingInfoId:this.$route.query.id\n      }\n      sendTextCardMessage(params).then(res=>{\n        this.$notifySty('提醒已发送')\n        console.log(res)\n        \n        this.sendMessage = res.data\n        this.sendMessage.paramInfo = JSON.parse(this.sendMessage.paramInfo)\n        this.sendMessage.sendInfo = JSON.parse(this.sendMessage.sendInfo)\n        this.sendMessage.date = formatDate(new Date(),'yyyy-MM-dd hh:mm:ss') \n\n        console.log(this.sendMessage)\n        this.showMoreBox = true\n        // this.sendMessage.wechatInfo = JSON.parse(this.sendMessage.wechatInfo)\n      })\n    }, \n    //查询当前季度上传文件状态\n    getNowUpType(type){\n      let params = {\n        lendingInfoId:this.$route.query.id,\n        year:this.newYear,\n        timeQuarter:this.isQuarter\n      }\n      if(type=='get'){\n        getLendingInfoConfirm(params).then(res=>{\n          this.nowUpType = res.data\n        })\n      }else{\n        lendingInfoConfirm(params).then(res=>{\n          this.nowUpType = res.data\n        })\n      }\n      \n    },\n\n    //年份变化\n    changeYear(){\n      this.changeIdx(this.isQuarter,'get')\n    },\n    showMore() {\n      this.showMoreBox = !this.showMoreBox\n    },\n  },\n}\n</script>\n<style lang=\"less\" scoped>\n\n.loadTwo{\n  .Tit-box{\n    width: 70%;    \n    .Tit-box-title{\n      line-height: 30px;\n      font-size: 14px;\n      text-align: center;\n    }\n    .Tit-box-cont{\n      line-height: 80px;\n      margin-top: -10px;\n      font-size: 15px;\n      text-align: center;\n    }\n    .Tit-box-buts{\n      display: flex;\n      justify-content: space-between;\n    }\n    .Tit-box-but{\n      flex: 1;\n    }\n  }\n    .file{\n    width: 33%;\n    height: 100%;\n    position:absolute;\n    left: 0;\n    opacity: 0;\n  }\n  \n  .right {\n\n    .time_input_div {\n      width: 100%;\n      height: 35px;\n      line-height: 35px;\n      font-size: 14px;\n      padding: 0 10px;\n      box-sizing: border-box;\n      border: 1px solid #aebab4;\n      border-radius: 1px;\n    }\n\n    select {\n      width: 100%;\n      height: 30px;\n      font-size: 14px;\n      padding: 0 10px;\n      box-sizing: border-box;\n      border: 1px solid #aebab4;\n      border-radius: 1px;\n      outline: none;\n      appearance: none;\n      -moz-appearance: none;\n      -webkit-appearance: none;\n      -ms-appearance: none;\n      background: #ffffff;\n    }          \n  }\n  .isSetIng{\n    color:green;\n  }\n  .van-tabs__line{\n    background-color: green !important;\n  }\n  .year-tab {\n    width: 100%;\n    height: 45px;\n    line-height: 45px;\n    background: #ffffff;\n    position: fixed;\n    top: 44px;\n    left: 0;\n    z-index: 999;\n    color: #3f3f3f;\n    font-size: 12px;\n    text-align: center;\n  }\n  .contact_container5 {\n    width: 94%;\n    margin: 60px auto 10px auto;\n    padding: 0px 10px 0px 10px;\n    box-sizing: border-box;\n    background: #ffffff;\n    .show-more {\n      width: 100%;\n      height: 40px;\n      line-height: 40px;\n      font-size: 12px;\n      color: #999999;\n      text-align: center;\n      .downIcon {\n        font-size: 8px;\n        position: relative;\n        left: 3px;\n        top: -1px;\n      }\n    }\n    .tab5_box {\n      width: 100%;\n      .tab5-count {\n        width: 100%;\n        height: 35px;\n        line-height: 35px;\n        color: #999999;\n        font-size: 12px;\n      }\n      .tab5-list {\n        width: 100%;\n        background: #ffffff;\n        box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);\n        border-radius: 5px;\n        padding: 10px 20px;\n        box-sizing: border-box;\n        margin-bottom: 15px;\n        position: relative;\n        .tab5-list-tilte {\n          width: 100%;\n          height: 35px;\n          line-height: 35px;\n          margin-bottom: 15px;\n          .span1 {\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            max-width: 65%;\n            font-size: 16px;\n            color: #333333;\n            font-weight: bold;\n            float: left;\n          }\n          .span2 {\n            font-size: 12px;\n            float: right;\n            font-weight: bold;\n          }\n        }\n        .tab5-list-p {\n          width: 100%;\n          height: 30px;\n          line-height: 30px;\n          font-size: 14px;\n          color: #333333;\n          .span-left {\n            width: 70%;\n            display: block;\n            float: left;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n          }\n          .span-right {\n            float: right;\n            color: #999999;\n          }\n        }\n        .tab5-list-p1 {\n          font-size: 14px;\n          color: #999999;\n        }\n      }\n    }\n  }\n  .more-show-box {\n    width: 94%;\n    margin: 0 auto;\n    margin-bottom: 10px;\n    color: #999999;\n    font-size: 12px;\n    padding: 10px;\n    box-sizing: border-box;\n    background: #ffffff;\n    p {\n      margin-bottom: 5px;\n    }\n    .message {\n      width: 100%;\n      display: flex;\n      .left {\n        width: 95px;\n      }\n    }\n  }\n  .kong {\n    width: 100%;\n    height: 44px;\n  }\n  .footer {\n    width: 100%;\n    height: 44px;\n    background: #fcfcfc;\n    position: fixed;\n    bottom: 0;\n    left: 0;\n  }\n}\n\n</style>\n"],"sourceRoot":"src/views/AfterLoanManagement"}]}