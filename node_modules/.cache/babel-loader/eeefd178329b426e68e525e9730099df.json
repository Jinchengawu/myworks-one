{"remainingRequest":"/Users/wangzhanyuan/code/my-works/one/node_modules/babel-loader/lib/index.js!/Users/wangzhanyuan/code/my-works/one/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhanyuan/code/my-works/one/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhanyuan/code/my-works/one/src/views/customerManagement/tab-dynamic.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhanyuan/code/my-works/one/src/views/customerManagement/tab-dynamic.vue","mtime":1564134165926},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangzhanyuan/code/my-works/one/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/wangzhanyuan/code/my-works/one/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { logList } from '@/service/home';\nimport { messageList, addMessages } from '@/service/customer';\nimport { isNull, addMark } from '@/utils';\nimport HomeSearch from '../Home/Home-search.vue';\nimport { firmInfo } from '@/service/customer';\nexport default {\n  name: 'Dynamic',\n  components: {\n    'home-search': HomeSearch\n  },\n  props: {\n    searchType: {\n      type: Number,\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      messageBoard: false,\n      AddmessageBoard: false,\n      messageStr: '',\n      messageError: false,\n      PermissionObj: this.$store.state.powerList.PermissionObj,\n      ///权限\n      tabIndex: 2,\n      searchObj: null,\n      pageLog: 1,\n      size: 5,\n      logDList: [],\n      totalLog: null,\n      loadingLog: false,\n      finishedLog: false,\n      finished_text: '没有更多数据啦',\n      error: false,\n      setingItem: {},\n      //选中某条动态\n      setingMessage: {},\n      //选中某条留言\n      messageLists: [],\n      //留言列表\n      notShowList: [],\n      //隐藏队列      \n      notCompanyId: false //是否含有CompanyId\n\n    };\n  },\n  computed: {},\n  created: function created() {\n    //this.getLogList()// 获取动态\n    // console.log('this.$props',this.$props,this.searchType)\n    this.notCompanyId = this.searchType == 1 ? true : false;\n  },\n  methods: {\n    //控制列表显示隐藏\n    ctrlListShow: function ctrlListShow(time) {\n      var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var mm = time.substring(5, 7);\n      var cpLogDList = this.logDList;\n      console.log('控制列表显示隐藏', this.notShowList);\n      var mdx = this.notShowList.indexOf(mm);\n      mdx > -1 ? this.notShowList.splice(mdx, 1) : this.notShowList.push(mm);\n      cpLogDList.map(function (d) {\n        var mmm = d.createTime.substring(5, 7);\n\n        if (mmm == mm) {\n          d.isShow = type;\n        }\n      });\n      this.logDList = cpLogDList;\n    },\n    getData: function getData(item) {\n      var _this = this;\n\n      var params = {\n        id: item.companyId\n      };\n      firmInfo(params).then(function (res) {\n        console.log('企业信息firmInfo', res);\n\n        _this.$store.commit('SET_USER_DATA', res.data);\n\n        _this.routerTos(item);\n      });\n    },\n    //展示留言\n    showMessage: function showMessage(item) {\n      this.messageBoard = !this.messageBoard;\n      this.setingMessage = item;\n      item.isRead = true;\n      this.getMessageList(item);\n    },\n    //获取留言列表\n    getMessageList: function getMessageList(item) {\n      var _this2 = this;\n\n      // console.log('notCompanyId',notCompanyId)\n      var params = {\n        eventType: item.eventType,\n        eventId: item.eventId,\n        messageId: item.messageId,\n        notCompanyId: this.notCompanyId // id:item.id,\n\n      };\n      messageList(params).then(function (res) {\n        _this2.messageLists = res.data || []; // console.log('获取留言',res)\n      });\n    },\n    //动态详情跳转\n    routerTos: function routerTos(item) {\n      if (!this.$store.getters.userData) {\n        this.getData(item);\n        return;\n      }\n\n      var strArr = this.$store.getters.AarrList;\n      var routerList = this.$store.getters.routerList;\n      var query = {\n        id: item.eventId,\n        OTP: 2,\n        CID: item.companyId // console.log(strArr.indexOf(item.eventType),item.eventType,strArr)\n\n      };\n      if (item.eventType == '13') query.Tid = item.eventId;\n\n      if (strArr.indexOf(item.eventType) > -1) {\n        this.$router.push({\n          path: routerList[strArr.indexOf(item.eventType)],\n          query: query\n        });\n      }\n    },\n    // 控制筛选\n    getSearch: function getSearch(data) {\n      console.log('动态列表控制筛选', data);\n      this.searchObj = data;\n      var searchType = false; // search是否变化\n\n      this.logDList = [];\n      this.totalLog = null;\n      this.loadingLog = true; // 加载状态结束\n\n      this.finished_text = '';\n      this.pageLog = 1;\n      this.onLoad();\n    },\n    clearDataSearch: function clearDataSearch(data) {\n      // 清除筛选数据\n      this.getSearch();\n    },\n    //唤醒留言表单\n    addMessage: function addMessage(item) {\n      var _this3 = this;\n\n      console.log('item', item);\n      this.setingItem = item;\n      this.messageBoard = false;\n      setTimeout(function () {\n        // 加载状态结束\n        _this3.AddmessageBoard = true;\n      }, 300);\n    },\n    // 留言板取消事件\n    messageClear: function messageClear() {\n      this.AddmessageBoard = false;\n      this.messageStr = '';\n      this.setingItem = {};\n    },\n    // 留言保存事件\n    messageSave: function messageSave() {\n      console.log('留言保存事件', this.messageStr);\n      this.setMessage();\n\n      if (isNull(this.messageStr)) {\n        this.messageError = true;\n        return;\n      }\n    },\n    //新增留言\n    setMessage: function setMessage() {\n      var _this4 = this;\n\n      var params = {\n        author: this.$store.getters.userInfo.name,\n        authorUserId: this.$store.getters.userInfo.id,\n        eventId: this.setingItem.eventId,\n        content: this.messageStr,\n        eventType: this.setingItem.eventType // console.log('新增留言',params)\n\n      };\n      addMessages(params).then(function (res) {\n        // console.log('获取留言',res)\n        _this4.messageStr = '';\n        _this4.messageError = false;\n        _this4.AddmessageBoard = false;\n\n        _this4.getInit();\n\n        _this4.onLoad();\n      });\n    },\n    getInit: function getInit() {\n      this.page = 1;\n      this.pageLog = 1;\n      this.logDList = [];\n      this.totalLog = null;\n      this.total = null;\n    },\n    // 加载数据\n    onLoad: function onLoad() {\n      var that = this;\n\n      if (this.logDList.length === this.totalLog) {\n        this.finishedLog = true; // 数据全部加载完成\n\n        this.loadingLog = false; // 加载状态结束\n\n        this.finished_text = '没有更多数据了';\n        return;\n      }\n\n      setTimeout(function () {\n        that.getLogList();\n      }, 1000);\n    },\n    // 获取动态列表\n    getLogList: function getLogList() {\n      var _this5 = this;\n\n      var parmes = _objectSpread({}, this.searchObj);\n\n      parmes.page = this.pageLog;\n      parmes.size = this.size; // console.log('获取动态列表parmes',parmes)\n\n      for (var i in parmes) {\n        parmes[i] === '' ? parmes[i] = null : '';\n      }\n\n      var that = this; // eslint-disable-next-line no-unused-expressions\n\n      if (this.searchType != 1) {\n        parmes.companyId = this.$store.getters.userData.companyId;\n        parmes.companyName = this.$store.getters.userData.companyName;\n      } // console.log('获取留言parmes',parmes)\n\n\n      logList(parmes).then(function (res) {\n        console.log('getLogList', res);\n        _this5.loadingLog = false; // 加载状态结束\n\n        _this5.totalLog = res.data.count;\n\n        if (res.data.operationLogVOS.length == 0 || !res.data.operationLogVOS) {\n          return;\n        }\n\n        if (_this5.logDList.length > 0) {\n          delete _this5.logDList[(_this5.pageLog - 1) * _this5.size - 1].bottom;\n        }\n\n        var mdxList = _this5.notShowList;\n        console.log('mdxList', mdxList); // if(mdxList.length>0){\n        //   mdxList.map(mm=>{\n        //     res.data.operationLogVOS.map(dd=>{\n        //       let mmm = dd.createTime.substring(5,7)\n        //       if(mmm==mm){\n        //         dd.isShow = !dd.isShow\n        //       }  \n        //     })                \n        //   })\n        // }        \n\n        _this5.logDList = _this5.logDList.concat(res.data.operationLogVOS);\n        that.logDList = addMark(that.logDList, 3);\n        _this5.pageLog += 1;\n      });\n    },\n    //排序\n    runSort: function runSort(e) {\n      this.logDList = this.logDList.reverse();\n    }\n  }\n};",{"version":3,"sources":["tab-dynamic.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div name=\"dynamic\">\n    <div class=\"contact_container\">\n      <div class=\"contact\">\n        <div class=\"contact\">\n          <!-- 筛选 -->\n          <home-search\n            v-if=\"searchType==1\"\n            :tab-index=\"tabIndex\"\n            :is-sort=\"true\"\n            :is-time=\"true\"\n            :not-show-search=\"true\"\n            @postSearch=\"getSearch($event)\"\n            @clearSearch=\"clearDataSearch($event)\"\n            @_runSort=\"runSort\"\n          />\n          <!-- 内容部分 -->\n          <div class=\"contact_container_er\">\n            <van-list\n              v-model=\"loadingLog\"\n              :finished=\"finishedLog\"\n              :finished-text=\"finished_text\"\n              :error.sync=\"error\"\n              error-text=\"请求失败，点击重新加载\"\n              @load=\"onLoad()\"\n            >\n              <div\n                v-for=\"(item,idx) in logDList\"\n                :key=\"idx\"\n                class=\"item-list\"\n                :class=\"{'topOne':item.top,}\"\n              >\n                <span\n                  v-if=\"item.top&&notShowList.indexOf(item.createTime.slice(5,7))==-1\"\n                  class=\"time\"\n                  @click=\"ctrlListShow(item.createTime)\"\n                >\n                  {{ item.createTime.slice(0,7) }}  \n                  <span class=\"plus\">+</span>                \n                </span>\n                \n                <span\n                  v-if=\"item.top&&notShowList.indexOf(item.createTime.slice(5,7))>-1\"\n                  class=\"time\"\n                  @click=\"ctrlListShow(item.createTime,true)\"\n                >\n                  {{ item.createTime.slice(0,7) }}\n                  <span class=\"plus\">+</span>\n                </span>\n                \n                <div\n                  v-if=\"item.isShow\"\n                  class=\"item-left\"\n                >\n                  <div\n                    :class=\"{'xian':true,'xianTop':item.top,'xianBottom':item.bottom}\"\n                  />\n                  <div :class=\"{'circular':true,'theme-background-colors':item.top||item.bottom}\" />\n                </div>\n                <div\n                  v-if=\"item.isShow\"\n                  class=\"item-right\"                  \n                  @click=\"routerTos(item)\"\n                >\n                  <div class=\"right\">\n                    <div class=\"top\">\n                      <h4 class=\"text_h4\">\n                        {{ item.companyName }}\n                      </h4>\n                      <p class=\"text_p\">\n                        动作：{{ item.editType + item.actionType }}\n                      </p>\n                      <p class=\"text_p\">\n                        最后跟进时间：{{ item.createTime }}\n                      </p>\n                      <p class=\"text_p\">\n                        所属项目：{{ item.projectName }}\n                      </p>\n                      <p class=\"text_p\">\n                        操作人：{{ item.operatorName }}\n                      </p>\n                      <span\n                        v-if=\"PermissionObj['messageboard_insert'] != undefined\"\n                        style=\"position:absolute;right:16px;bottom:65px;\"\n                        class=\"iconfont iconliuyan theme-colors\"\n                        @click.stop=\"addMessage(item)\"\n                      />\n                      <div\n                        v-if=\"item.messageId && PermissionObj['messageboard_list'] != undefined\"\n                        class=\"message\"\n                        @click.stop=\"showMessage(item)\"\n                      >\n                        <div class=\"message-left\">\n                          {{ item.content }}\n                        </div>\n                        <div\n                          class=\"message-right\"\n                        >\n                          <span>{{ item.messageTime }}</span>\n                          <van-icon\n                            style=\"position:relative;top:2px;\"\n                            name=\"arrow\"\n                          />\n                        </div>\n\n                        <span\n                          v-if=\"!item.isRead\"\n                          style=\"position:absolute;right:0;top:1px;color:#ff0021;\"\n                          class=\"iconfont iconnew\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </van-list>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 留言板弹层 -->\n    <van-popup v-model=\"messageBoard\">\n      <div class=\"messageBoard\">\n        <div class=\"header\">\n          留言板\n        </div>\n        <div\n          v-for=\"(item,idx) in messageLists\"\n          :key=\"idx\"\n          class=\"container\"\n        >\n          <div class=\"container_header\">\n            <span style=\"float:left;\">{{ item.author }}</span>\n            <span style=\"float:right;\">{{ item.createTime }}</span>\n          </div>\n          <div class=\"container_p\">\n            {{ item.content }}\n          </div>\n        </div>\n      </div>\n    </van-popup>\n\n    <!-- 新增留言弹层 -->\n    <van-popup v-model=\"AddmessageBoard\">\n      <div class=\"messageBoard\">\n        <div class=\"header\">\n          留言板\n        </div>\n        <div class=\"container\">\n          <textarea\n            v-model=\"messageStr\"\n            :class=\"messageError ? 'textarea_no' :'textarea_yes'\"\n            placeholder=\"请输入留言\"\n          />\n        </div>\n        <van-row>\n          <van-col span=\"12\">\n            <van-button\n              class=\"clear-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"messageClear()\"\n            >\n              取消\n            </van-button>\n          </van-col>\n          <van-col span=\"12\">\n            <van-button\n              class=\"confirm-btn\"\n              style=\"width:100%;\"\n              square\n              type=\"primary\"\n              @click=\"messageSave\"\n            >\n              确定\n            </van-button>\n          </van-col>\n        </van-row>\n      </div>\n    </van-popup>\n  </div>\n</template>\n<script>\nimport { logList,} from '@/service/home'\nimport { messageList,addMessages } from '@/service/customer'\nimport { isNull,addMark } from '@/utils'\nimport HomeSearch from '../Home/Home-search.vue'\nimport { firmInfo } from '@/service/customer'\nexport default {\n  name: 'Dynamic',\n  components: {\n    'home-search': HomeSearch,\n  },\n  props:{\n    searchType:{\n      type:Number,\n      default:null\n    }\n  },\n  data() {\n    return {\n      messageBoard: false,\n      AddmessageBoard: false,\n      messageStr: '',\n      messageError: false,\n      PermissionObj:this.$store.state.powerList.PermissionObj,///权限\n      tabIndex: 2,\n      searchObj: null,\n      pageLog: 1,\n      size: 5,\n      logDList: [],\n      totalLog: null,\n      loadingLog: false,\n      finishedLog: false,\n      finished_text: '没有更多数据啦',\n      error: false,\n      setingItem:{},//选中某条动态\n      setingMessage:{},//选中某条留言\n      messageLists:[],//留言列表\n      notShowList:[],//隐藏队列      \n      notCompanyId:false,//是否含有CompanyId\n    }\n  },\n  computed: {\n    \n  },\n  created() {\n    //this.getLogList()// 获取动态\n    // console.log('this.$props',this.$props,this.searchType)\n    this.notCompanyId = this.searchType==1 ? true : false\n  },\n  methods: {\n    //控制列表显示隐藏\n    ctrlListShow(time,type=false){\n      \n      let mm  = time.substring(5,7)\n      let cpLogDList = this.logDList\n      console.log('控制列表显示隐藏',this.notShowList)\n      let mdx = this.notShowList.indexOf(mm)\n      mdx > -1 ? this.notShowList.splice(mdx,1):this.notShowList.push(mm)\n\n      cpLogDList.map(d=>{\n        let mmm = d.createTime.substring(5,7)\n        if(mmm==mm){\n          d.isShow = type\n        }        \n      })\n      this.logDList = cpLogDList\n    },\n    getData(item) {\n      const params = {\n        id: item.companyId,\n      }\n      firmInfo(params).then((res) => {    \n        console.log('企业信息firmInfo',res)\n        this.$store.commit('SET_USER_DATA', res.data)\n        this.routerTos(item)\n      })\n    },\n     //展示留言\n    showMessage(item){\n      this.messageBoard = !this.messageBoard\n      this.setingMessage = item\n      item.isRead = true\n      this.getMessageList(item)\n    },\n    //获取留言列表\n    getMessageList(item){\n      // console.log('notCompanyId',notCompanyId)\n      let params = {\n        eventType:item.eventType,\n        eventId:item.eventId,\n        messageId:item.messageId,\n        notCompanyId:this.notCompanyId\n        // id:item.id,\n      }\n      \n      messageList(params).then(res=>{\n        this.messageLists = res.data || []\n        // console.log('获取留言',res)\n      })\n    },\n    //动态详情跳转\n    routerTos(item){\n      if(!this.$store.getters.userData){\n        this.getData(item)\n        return\n      }\n      let strArr = this.$store.getters.AarrList\n      let routerList = this.$store.getters.routerList\n      let query = {\n            id:item.eventId,\n            OTP:2,\n            CID:item.companyId\n          }\n      // console.log(strArr.indexOf(item.eventType),item.eventType,strArr)\n      if(item.eventType=='13')query.Tid = item.eventId\n      \n      if(strArr.indexOf(item.eventType)>-1){\n\n        this.$router.push({\n          path:routerList[strArr.indexOf(item.eventType)],\n          query:query\n       })\n      }      \n    },\n    // 控制筛选\n    getSearch(data) {\n      console.log('动态列表控制筛选',data)\n      this.searchObj = data      \n      let searchType = false // search是否变化\n      this.logDList  = []\n      this.totalLog = null\n      this.loadingLog = true// 加载状态结束\n      this.finished_text = ''\n      this.pageLog  = 1\n      this.onLoad()\n    },\n    clearDataSearch(data) {\n      // 清除筛选数据\n      this.getSearch()\n    },\n    //唤醒留言表单\n    addMessage(item) {\n      console.log('item',item)\n      this.setingItem = item\n      this.messageBoard = false\n      setTimeout(() => {\n        // 加载状态结束\n        this.AddmessageBoard = true\n      }, 300)\n    },\n    // 留言板取消事件\n    messageClear() {\n      \n      this.AddmessageBoard = false\n      this.messageStr = ''\n      this.setingItem = {}\n    },\n    // 留言保存事件\n    messageSave() {\n      console.log('留言保存事件',this.messageStr)\n      this.setMessage()\n      if (isNull(this.messageStr)) {\n        this.messageError = true\n        return\n      }\n      \n    },\n    //新增留言\n    setMessage(){      \n      let params = {\n        author:this.$store.getters.userInfo.name,\n        authorUserId:this.$store.getters.userInfo.id,\n        eventId:this.setingItem.eventId,\n        content:this.messageStr,\n        eventType:this.setingItem.eventType\n      }\n      // console.log('新增留言',params)\n      addMessages(params).then(res=>{\n        // console.log('获取留言',res)\n        this.messageStr = ''\n        this.messageError = false     \n        this.AddmessageBoard = false\n        this.getInit()\n        this.onLoad()\n      })\n    },\n    getInit(){\n      this.page=1\n      this.pageLog = 1\n      this.logDList = []\n      this.totalLog = null\n      this.total = null\n    },\n    // 加载数据\n    onLoad() {\n      const that = this\n      if (this.logDList.length === this.totalLog) {\n        this.finishedLog = true // 数据全部加载完成\n        this.loadingLog = false// 加载状态结束\n        this.finished_text = '没有更多数据了'\n        return\n      } \n      setTimeout(() => {\n        that.getLogList()\n      }, 1000)\n    },\n    // 获取动态列表\n    getLogList() {\n      \n      let parmes = {...this.searchObj}\n      parmes.page =  this.pageLog\n      parmes.size =  this.size\n      // console.log('获取动态列表parmes',parmes)\n      for(let i in parmes){\n        parmes[i] === ''?parmes[i] = null:''\n        \n      }\n      let that = this\n      // eslint-disable-next-line no-unused-expressions\n      if(this.searchType!=1){\n        parmes.companyId= this.$store.getters.userData.companyId\n        parmes.companyName= this.$store.getters.userData.companyName\n      }\n      // console.log('获取留言parmes',parmes)\n      logList(parmes).then((res) => {\n        console.log('getLogList', res)\n        this.loadingLog = false// 加载状态结束\n        this.totalLog = res.data.count\n        if(res.data.operationLogVOS.length==0||!res.data.operationLogVOS){\n          return\n        }\n        if (this.logDList.length > 0) {\n          delete this.logDList[(this.pageLog - 1) * (this.size) - 1].bottom\n        }\n        let mdxList = this.notShowList\n        console.log('mdxList',mdxList)\n        // if(mdxList.length>0){\n        //   mdxList.map(mm=>{\n        //     res.data.operationLogVOS.map(dd=>{\n        //       let mmm = dd.createTime.substring(5,7)\n        //       if(mmm==mm){\n        //         dd.isShow = !dd.isShow\n        //       }  \n        //     })                \n        //   })\n        // }        \n        this.logDList = this.logDList.concat(res.data.operationLogVOS)\n        that.logDList = addMark(that.logDList,3)        \n        \n        this.pageLog += 1\n        \n      })\n    },\n    //排序\n    runSort(e){\n       this.logDList = this.logDList.reverse()\n    }\n    \n  },\n}\n</script>\n<style lang=\"less\" scoped>\n.plus{\n  border: 1px solid #03c061;\n    border-radius: 50%;\n    width: 13px;\n    height: 13px;\n    display: block;\n    text-align: center;\n    line-height: 13px;\n    color: #03c061;\n    font-size: 15px;\n    position: relative;\n    top: 10px;\n    left: 3px;\n}\n.contact_container {\n  width: 100%;\n  padding: 10px;\n  box-sizing: border-box;\n  background: #fcfcfc;\n  .topOne{\n    position: relative;\n    padding-top: 40px;\n  }\n  .time {\n        width: 100%;\n        height: 35px;\n        line-height: 35px;\n        color: #626262;\n        font-size: 12px;\n        position:absolute;\n        top: 0;\n        display: flex;\n      }\n  .item-list {\n    width: 100%;\n    display: flex;\n    box-sizing: border-box;\n    .item-left {\n      width: 24px;\n      margin-right: 10px;\n      position: relative;\n      .xianTop{\n        height: 50% !important;\n      }\n      .xianBottom{\n        height: 50% !important;\n        top:0 !important;\n      }\n      .xian {\n        width: 2px;\n        height: 100%;\n        position: absolute;\n        bottom: 0;\n        left: 11px;\n        background: #dddddd;\n      }\n      .circular {\n        width: 24px;\n        height: 24px;\n        border-radius: 12px;\n        background: #dddddd;\n        position: absolute;\n        bottom: 50%;\n        left: 0px;\n      }\n    }\n    .item-right {\n      min-width: 0;\n      flex: 1;\n      padding-bottom: 20px;\n\n      .right {\n        width: 100%;\n        background: #ffffff;\n        box-shadow: 0 2px 8px 0 rgba(153, 153, 153, 0.24);\n        border-radius: 8px;\n        .top {\n          width: 100%;\n          box-sizing: border-box;\n          padding: 10px 20px 5px;\n          position: relative;\n          .text_h4 {\n            margin-bottom: 10px;\n            color: #03c061;\n            font-size: 16px;\n            font-weight: bolder;\n          }\n          .text_p {\n            width: 100%;\n            height: 25px;\n            line-height: 25px;\n            color: #333333;\n            font-size: 12px;\n          }\n        }\n        .message {\n          width: 100%;\n          padding: 5px 5px 5px 5px;\n          margin-top: 3px;\n          box-sizing: border-box;\n          border-top: 1px dashed #dddddd;\n          display: flex;\n          position: relative;\n          .message-left {\n            width:60%;\n            height: 20px;\n            line-height: 20px;\n            font-size: 12px;\n            color: #333333;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            min-width: 0;\n          }\n          .message-right {\n            // width: 35%;\n            // width: 30%;\n            height: 20px;\n            min-width: 0;\n            line-height: 20px;\n            // text-align: right;\n            font-size: 12px;\n            color: #333333;\n          }\n        }\n      }\n    }\n  }\n}\n.tab-footer {\n  width: 100%;\n  height: 70px;\n  background: #fcfcfc;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  padding: 0 10px;\n  box-sizing: border-box;\n}\n.messageBoard {\n  width: 240px;\n  .header {\n    width: 90%;\n    margin: 0 auto;\n    height: 40px;\n    font-size: 16px;\n    font-weight: bold;\n    line-height: 40px;\n    text-align: center;\n    border-bottom: 1px solid #dddddd;\n    position: relative;\n    .header-btn {\n      position: absolute;\n      right: 0;\n      top: 0;\n      color: #00703a;\n      font-size: 14px;\n      font-weight: normal;\n    }\n  }\n  .container {\n    width: 90%;\n    margin: 0 auto;\n    min-height: 150px;\n    border-bottom: 1px solid #dddddd;\n    .container_header {\n      width: 100%;\n      height: 35px;\n      line-height: 35px;\n      color: #626262;\n      font-size: 12px;\n    }\n    .container_p {\n      width: 100%;\n      line-height: 20px;\n      color: #333333;\n      font-size: 12px;\n    }\n    textarea {\n      width: 100%;\n      max-height: 120px;\n      min-height: 120px;\n      padding: 10px;\n      font-size: 12px;\n      box-sizing: border-box;\n      outline: none;\n      resize: none;\n      overflow-y: auto;\n    }\n    .textarea_no {\n      border: 1px solid #ff0021;\n    }\n    .textarea_yes {\n      border: 1px solid #999999;\n    }\n  }\n}\n</style>\n"],"sourceRoot":"src/views/customerManagement"}]}